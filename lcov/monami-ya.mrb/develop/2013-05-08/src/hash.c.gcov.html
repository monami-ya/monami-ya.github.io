<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - monami-ya.mrb_develop.info - src/hash.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">src</a> - hash.c<span style="font-size: 80%;"> (source / <a href="hash.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">monami-ya.mrb_develop.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">231</td>
            <td class="headerCovTableEntry">334</td>
            <td class="headerCovTableEntryLo">69.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2013-05-08</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">42</td>
            <td class="headerCovTableEntry">57</td>
            <td class="headerCovTableEntryLo">73.7 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            : ** hash.c - Hash class
<span class="lineNum">       3 </span>            : **
<span class="lineNum">       4 </span>            : ** See Copyright Notice in mruby.h
<span class="lineNum">       5 </span>            : */
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            : #include &quot;mruby.h&quot;
<span class="lineNum">       8 </span>            : #include &quot;mruby/array.h&quot;
<span class="lineNum">       9 </span>            : #include &quot;mruby/class.h&quot;
<span class="lineNum">      10 </span>            : #include &quot;mruby/hash.h&quot;
<span class="lineNum">      11 </span>            : #include &quot;mruby/khash.h&quot;
<span class="lineNum">      12 </span>            : #include &quot;mruby/string.h&quot;
<span class="lineNum">      13 </span>            : #include &quot;mruby/variable.h&quot;
<span class="lineNum">      14 </span>            : 
<a name="15"><span class="lineNum">      15 </span>            : static inline khint_t</a>
<span class="lineNum">      16 </span>            : mrb_hash_ht_hash_func(mrb_state *mrb, mrb_value key)
<span class="lineNum">      17 </span><span class="lineCov">        351 : {</span>
<span class="lineNum">      18 </span><span class="lineCov">        351 :   khint_t h = (khint_t)mrb_type(key) &lt;&lt; 24;</span>
<span class="lineNum">      19 </span>            :   mrb_value h2;
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span><span class="lineCov">        351 :   h2 = mrb_funcall(mrb, key, &quot;hash&quot;, 0, 0);</span>
<span class="lineNum">      22 </span><span class="lineCov">        351 :   h ^= h2.value.i;</span>
<span class="lineNum">      23 </span><span class="lineCov">        351 :   return h;</span>
<span class="lineNum">      24 </span>            : }
<span class="lineNum">      25 </span>            : 
<a name="26"><span class="lineNum">      26 </span>            : static inline khint_t</a>
<span class="lineNum">      27 </span>            : mrb_hash_ht_hash_equal(mrb_state *mrb, mrb_value a, mrb_value b)
<span class="lineNum">      28 </span><span class="lineCov">        147 : {</span>
<span class="lineNum">      29 </span><span class="lineCov">        147 :   return mrb_eql(mrb, a, b);</span>
<span class="lineNum">      30 </span>            : }
<a name="31"><span class="lineNum">      31 </span>            : </a>
<span class="lineNum">      32 </span>            : KHASH_DECLARE(ht, mrb_value, mrb_value, 1)
<span class="lineNum">      33 </span><span class="lineCov">        790 : KHASH_DEFINE (ht, mrb_value, mrb_value, 1, mrb_hash_ht_hash_func, mrb_hash_ht_hash_equal)</span>
<span class="lineNum">      34 </span>            : 
<span class="lineNum">      35 </span>            : static void mrb_hash_modify(mrb_state *mrb, mrb_value hash);
<span class="lineNum">      36 </span>            : 
<a name="37"><span class="lineNum">      37 </span>            : static inline mrb_value</a>
<span class="lineNum">      38 </span>            : mrb_hash_ht_key(mrb_state *mrb, mrb_value key)
<span class="lineNum">      39 </span><span class="lineCov">        113 : {</span>
<span class="lineNum">      40 </span><span class="lineCov">        113 :   if (mrb_string_p(key))</span>
<span class="lineNum">      41 </span><span class="lineCov">         65 :     return mrb_str_dup(mrb, key);</span>
<span class="lineNum">      42 </span>            :   else
<span class="lineNum">      43 </span><span class="lineCov">         48 :     return key;</span>
<span class="lineNum">      44 </span>            : }
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : #define KEY(key) mrb_hash_ht_key(mrb, key)
<span class="lineNum">      47 </span>            : 
<a name="48"><span class="lineNum">      48 </span>            : void</a>
<span class="lineNum">      49 </span>            : mrb_gc_mark_hash(mrb_state *mrb, struct RHash *hash)
<span class="lineNum">      50 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      51 </span>            :   khiter_t k;
<span class="lineNum">      52 </span><span class="lineNoCov">          0 :   khash_t(ht) *h = hash-&gt;ht;</span>
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :   if (!h) return;</span>
<span class="lineNum">      55 </span><span class="lineNoCov">          0 :   for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :     if (kh_exist(h, k)) {</span>
<span class="lineNum">      57 </span><span class="lineNoCov">          0 :       mrb_value key = kh_key(h, k);</span>
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :       mrb_value val = kh_value(h, k);</span>
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span><span class="lineNoCov">          0 :       mrb_gc_mark_value(mrb, key);</span>
<span class="lineNum">      61 </span><span class="lineNoCov">          0 :       mrb_gc_mark_value(mrb, val);</span>
<span class="lineNum">      62 </span>            :     }
<span class="lineNum">      63 </span>            :   }
<span class="lineNum">      64 </span>            : }
<span class="lineNum">      65 </span>            : 
<a name="66"><span class="lineNum">      66 </span>            : size_t</a>
<span class="lineNum">      67 </span>            : mrb_gc_mark_hash_size(mrb_state *mrb, struct RHash *hash)
<span class="lineNum">      68 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :   if (!hash-&gt;ht) return 0;</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :   return kh_size(hash-&gt;ht)*2;</span>
<span class="lineNum">      71 </span>            : }
<span class="lineNum">      72 </span>            : 
<a name="73"><span class="lineNum">      73 </span>            : void</a>
<span class="lineNum">      74 </span>            : mrb_gc_free_hash(mrb_state *mrb, struct RHash *hash)
<span class="lineNum">      75 </span><span class="lineCov">         81 : {</span>
<span class="lineNum">      76 </span><span class="lineCov">         81 :   if (hash-&gt;ht) kh_destroy(ht, hash-&gt;ht);</span>
<span class="lineNum">      77 </span><span class="lineCov">         81 : }</span>
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : 
<a name="80"><span class="lineNum">      80 </span>            : mrb_value</a>
<span class="lineNum">      81 </span>            : mrb_hash_new_capa(mrb_state *mrb, int capa)
<span class="lineNum">      82 </span><span class="lineCov">         61 : {</span>
<span class="lineNum">      83 </span>            :   struct RHash *h;
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span><span class="lineCov">         61 :   h = (struct RHash*)mrb_obj_alloc(mrb, MRB_TT_HASH, mrb-&gt;hash_class);</span>
<span class="lineNum">      86 </span><span class="lineCov">         61 :   h-&gt;ht = kh_init(ht, mrb);</span>
<span class="lineNum">      87 </span><span class="lineCov">         61 :   if (capa &gt; 0) {</span>
<span class="lineNum">      88 </span><span class="lineCov">         52 :     kh_resize(ht, h-&gt;ht, capa);</span>
<span class="lineNum">      89 </span>            :   }
<span class="lineNum">      90 </span><span class="lineCov">         61 :   h-&gt;iv = 0;</span>
<span class="lineNum">      91 </span><span class="lineCov">         61 :   return mrb_obj_value(h);</span>
<span class="lineNum">      92 </span>            : }
<span class="lineNum">      93 </span>            : 
<a name="94"><span class="lineNum">      94 </span>            : mrb_value</a>
<span class="lineNum">      95 </span>            : mrb_hash_new(mrb_state *mrb)
<span class="lineNum">      96 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :   return mrb_hash_new_capa(mrb, 0);</span>
<span class="lineNum">      98 </span>            : }
<span class="lineNum">      99 </span>            : 
<a name="100"><span class="lineNum">     100 </span>            : mrb_value</a>
<span class="lineNum">     101 </span>            : mrb_hash_get(mrb_state *mrb, mrb_value hash, mrb_value key)
<span class="lineNum">     102 </span><span class="lineCov">         53 : {</span>
<span class="lineNum">     103 </span><span class="lineCov">         53 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     104 </span>            :   khiter_t k;
<span class="lineNum">     105 </span>            : 
<span class="lineNum">     106 </span><span class="lineCov">         53 :   if (h) {</span>
<span class="lineNum">     107 </span><span class="lineCov">         53 :     k = kh_get(ht, h, key);</span>
<span class="lineNum">     108 </span><span class="lineCov">         53 :     if (k != kh_end(h))</span>
<span class="lineNum">     109 </span><span class="lineCov">         45 :       return kh_value(h, k);</span>
<span class="lineNum">     110 </span>            :   }
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span>            :   /* not found */
<span class="lineNum">     113 </span><span class="lineCov">          8 :   if (MRB_RHASH_PROCDEFAULT_P(hash)) {</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :     return mrb_funcall(mrb, RHASH_PROCDEFAULT(hash), &quot;call&quot;, 2, hash, key);</span>
<span class="lineNum">     115 </span>            :   }
<span class="lineNum">     116 </span><span class="lineCov">          8 :   return RHASH_IFNONE(hash);</span>
<span class="lineNum">     117 </span>            : }
<span class="lineNum">     118 </span>            : 
<a name="119"><span class="lineNum">     119 </span>            : mrb_value</a>
<span class="lineNum">     120 </span>            : mrb_hash_fetch(mrb_state *mrb, mrb_value hash, mrb_value key, mrb_value def)
<span class="lineNum">     121 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     123 </span>            :   khiter_t k;
<span class="lineNum">     124 </span>            : 
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :   if (h) {</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :     k = kh_get(ht, h, key);</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :     if (k != kh_end(h))</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :       return kh_value(h, k);</span>
<span class="lineNum">     129 </span>            :   }
<span class="lineNum">     130 </span>            : 
<span class="lineNum">     131 </span>            :   /* not found */
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :   return def;</span>
<span class="lineNum">     133 </span>            : }
<span class="lineNum">     134 </span>            : 
<a name="135"><span class="lineNum">     135 </span>            : void</a>
<span class="lineNum">     136 </span>            : mrb_hash_set(mrb_state *mrb, mrb_value hash, mrb_value key, mrb_value val) /* mrb_hash_aset */
<span class="lineNum">     137 </span><span class="lineCov">        117 : {</span>
<span class="lineNum">     138 </span>            :   khash_t(ht) *h;
<span class="lineNum">     139 </span>            :   khiter_t k;
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span><span class="lineCov">        117 :   mrb_hash_modify(mrb, hash);</span>
<span class="lineNum">     142 </span><span class="lineCov">        117 :   h = RHASH_TBL(hash);</span>
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span><span class="lineCov">        117 :   if (!h) h = RHASH_TBL(hash) = kh_init(ht, mrb);</span>
<span class="lineNum">     145 </span><span class="lineCov">        117 :   k = kh_get(ht, h, key);</span>
<span class="lineNum">     146 </span><span class="lineCov">        117 :   if (k == kh_end(h)) {</span>
<span class="lineNum">     147 </span>            :     /* expand */
<span class="lineNum">     148 </span><span class="lineCov">        113 :     k = kh_put(ht, h, KEY(key));</span>
<span class="lineNum">     149 </span>            :   }
<span class="lineNum">     150 </span>            : 
<span class="lineNum">     151 </span><span class="lineCov">        117 :   kh_value(h, k) = val;</span>
<span class="lineNum">     152 </span><span class="lineCov">        117 :   mrb_write_barrier(mrb, (struct RBasic*)RHASH(hash));</span>
<span class="lineNum">     153 </span>            :   return;
<span class="lineNum">     154 </span>            : }
<span class="lineNum">     155 </span>            : 
<a name="156"><span class="lineNum">     156 </span>            : mrb_value</a>
<span class="lineNum">     157 </span>            : mrb_hash_dup(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     158 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     159 </span>            :   struct RHash* ret;
<span class="lineNum">     160 </span>            :   khash_t(ht) *h, *ret_h;
<span class="lineNum">     161 </span>            :   khiter_t k, ret_k;
<span class="lineNum">     162 </span>            : 
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :   h = RHASH_TBL(hash);</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :   ret = (struct RHash*)mrb_obj_alloc(mrb, MRB_TT_HASH, mrb-&gt;hash_class);</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :   ret-&gt;ht = kh_init(ht, mrb);</span>
<span class="lineNum">     166 </span>            : 
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :   if (kh_size(h) &gt; 0) {</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :     ret_h = ret-&gt;ht;</span>
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :     for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :       if (kh_exist(h,k)) {</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :         ret_k = kh_put(ht, ret_h, KEY(kh_key(h,k)));</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :         kh_val(ret_h, ret_k) = kh_val(h,k);</span>
<span class="lineNum">     174 </span>            :       }
<span class="lineNum">     175 </span>            :     }
<span class="lineNum">     176 </span>            :   }
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :   return mrb_obj_value(ret);</span>
<span class="lineNum">     179 </span>            : }
<span class="lineNum">     180 </span>            : 
<a name="181"><span class="lineNum">     181 </span>            : mrb_value</a>
<span class="lineNum">     182 </span>            : mrb_check_hash_type(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     183 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :   return mrb_check_convert_type(mrb, hash, MRB_TT_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);</span>
<span class="lineNum">     185 </span>            : }
<span class="lineNum">     186 </span>            : 
<a name="187"><span class="lineNum">     187 </span>            : khash_t(ht) *</a>
<span class="lineNum">     188 </span>            : mrb_hash_tbl(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     189 </span><span class="lineCov">        139 : {</span>
<span class="lineNum">     190 </span><span class="lineCov">        139 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span><span class="lineCov">        139 :   if (!h) {</span>
<span class="lineNum">     193 </span><span class="lineCov">         20 :     RHASH_TBL(hash) = kh_init(ht, mrb);</span>
<span class="lineNum">     194 </span>            :   }
<span class="lineNum">     195 </span><span class="lineCov">        139 :   return h;</span>
<span class="lineNum">     196 </span>            : }
<span class="lineNum">     197 </span>            : 
<a name="198"><span class="lineNum">     198 </span>            : static void</a>
<span class="lineNum">     199 </span>            : mrb_hash_modify(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     200 </span><span class="lineCov">        139 : {</span>
<span class="lineNum">     201 </span><span class="lineCov">        139 :   mrb_hash_tbl(mrb, hash);</span>
<span class="lineNum">     202 </span><span class="lineCov">        139 : }</span>
<span class="lineNum">     203 </span>            : 
<span class="lineNum">     204 </span>            : /* 15.2.13.4.16 */
<span class="lineNum">     205 </span>            : /*
<span class="lineNum">     206 </span>            :  *  call-seq:
<span class="lineNum">     207 </span>            :  *     Hash.new                          -&gt; new_hash
<span class="lineNum">     208 </span>            :  *     Hash.new(obj)                     -&gt; new_hash
<span class="lineNum">     209 </span>            :  *     Hash.new {|hash, key| block }     -&gt; new_hash
<span class="lineNum">     210 </span>            :  *
<span class="lineNum">     211 </span>            :  *  Returns a new, empty hash. If this hash is subsequently accessed by
<span class="lineNum">     212 </span>            :  *  a key that doesn't correspond to a hash entry, the value returned
<span class="lineNum">     213 </span>            :  *  depends on the style of &lt;code&gt;new&lt;/code&gt; used to create the hash. In
<span class="lineNum">     214 </span>            :  *  the first form, the access returns &lt;code&gt;nil&lt;/code&gt;. If
<span class="lineNum">     215 </span>            :  *  &lt;i&gt;obj&lt;/i&gt; is specified, this single object will be used for
<span class="lineNum">     216 </span>            :  *  all &lt;em&gt;default values&lt;/em&gt;. If a block is specified, it will be
<span class="lineNum">     217 </span>            :  *  called with the hash object and the key, and should return the
<span class="lineNum">     218 </span>            :  *  default value. It is the block's responsibility to store the value
<span class="lineNum">     219 </span>            :  *  in the hash if required.
<span class="lineNum">     220 </span>            :  *
<span class="lineNum">     221 </span>            :  *     h = Hash.new(&quot;Go Fish&quot;)
<span class="lineNum">     222 </span>            :  *     h[&quot;a&quot;] = 100
<span class="lineNum">     223 </span>            :  *     h[&quot;b&quot;] = 200
<span class="lineNum">     224 </span>            :  *     h[&quot;a&quot;]           #=&gt; 100
<span class="lineNum">     225 </span>            :  *     h[&quot;c&quot;]           #=&gt; &quot;Go Fish&quot;
<span class="lineNum">     226 </span>            :  *     # The following alters the single default object
<span class="lineNum">     227 </span>            :  *     h[&quot;c&quot;].upcase!   #=&gt; &quot;GO FISH&quot;
<span class="lineNum">     228 </span>            :  *     h[&quot;d&quot;]           #=&gt; &quot;GO FISH&quot;
<span class="lineNum">     229 </span>            :  *     h.keys           #=&gt; [&quot;a&quot;, &quot;b&quot;]
<span class="lineNum">     230 </span>            :  *
<span class="lineNum">     231 </span>            :  *     # While this creates a new default object each time
<span class="lineNum">     232 </span>            :  *     h = Hash.new { |hash, key| hash[key] = &quot;Go Fish: #{key}&quot; }
<span class="lineNum">     233 </span>            :  *     h[&quot;c&quot;]           #=&gt; &quot;Go Fish: c&quot;
<span class="lineNum">     234 </span>            :  *     h[&quot;c&quot;].upcase!   #=&gt; &quot;GO FISH: C&quot;
<span class="lineNum">     235 </span>            :  *     h[&quot;d&quot;]           #=&gt; &quot;Go Fish: d&quot;
<span class="lineNum">     236 </span>            :  *     h.keys           #=&gt; [&quot;c&quot;, &quot;d&quot;]
<span class="lineNum">     237 </span>            :  *
<span class="lineNum">     238 </span>            :  */
<span class="lineNum">     239 </span>            : 
<a name="240"><span class="lineNum">     240 </span>            : static mrb_value</a>
<span class="lineNum">     241 </span>            : mrb_hash_init_core(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     242 </span><span class="lineCov">         20 : {</span>
<span class="lineNum">     243 </span>            :   mrb_value block, ifnone;
<span class="lineNum">     244 </span>            :   mrb_value *argv;
<span class="lineNum">     245 </span>            :   int argc;
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span><span class="lineCov">         20 :   mrb_get_args(mrb, &quot;o*&quot;, &amp;block, &amp;argv, &amp;argc);</span>
<span class="lineNum">     248 </span><span class="lineCov">         20 :   mrb_hash_modify(mrb, hash);</span>
<span class="lineNum">     249 </span><span class="lineCov">         38 :   if (mrb_nil_p(block)) {</span>
<span class="lineNum">     250 </span><span class="lineCov">         18 :     if (argc &gt; 0) {</span>
<span class="lineNum">     251 </span><span class="lineCov">          2 :       if (argc != 1) mrb_raise(mrb, E_ARGUMENT_ERROR, &quot;wrong number of arguments&quot;);</span>
<span class="lineNum">     252 </span><span class="lineCov">          2 :       ifnone = argv[0];</span>
<span class="lineNum">     253 </span>            :     }
<span class="lineNum">     254 </span>            :     else {
<span class="lineNum">     255 </span><span class="lineCov">         16 :       ifnone = mrb_nil_value();</span>
<span class="lineNum">     256 </span>            :     }
<span class="lineNum">     257 </span>            :   }
<span class="lineNum">     258 </span>            :   else {
<span class="lineNum">     259 </span><span class="lineCov">          2 :     if (argc &gt; 0) {</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :       mrb_raise(mrb, E_ARGUMENT_ERROR, &quot;wrong number of arguments&quot;);</span>
<span class="lineNum">     261 </span>            :     }
<span class="lineNum">     262 </span><span class="lineCov">          2 :     RHASH(hash)-&gt;flags |= MRB_HASH_PROC_DEFAULT;</span>
<span class="lineNum">     263 </span><span class="lineCov">          2 :     ifnone = block;</span>
<span class="lineNum">     264 </span>            :   }
<span class="lineNum">     265 </span><span class="lineCov">         20 :   mrb_iv_set(mrb, hash, mrb_intern2(mrb, &quot;ifnone&quot;, 6), ifnone);</span>
<span class="lineNum">     266 </span><span class="lineCov">         20 :   return hash;</span>
<span class="lineNum">     267 </span>            : }
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span>            : /*
<span class="lineNum">     270 </span>            :  *  call-seq:
<span class="lineNum">     271 </span>            :  *     Hash[ key, value, ... ]         -&gt; new_hash
<span class="lineNum">     272 </span>            :  *     Hash[ [ [key, value], ... ] ]   -&gt; new_hash
<span class="lineNum">     273 </span>            :  *     Hash[ object ]                  -&gt; new_hash
<span class="lineNum">     274 </span>            :  *
<span class="lineNum">     275 </span>            :  *  Creates a new hash populated with the given objects. Equivalent to
<span class="lineNum">     276 </span>            :  *  the literal &lt;code&gt;{ &lt;i&gt;key&lt;/i&gt; =&gt; &lt;i&gt;value&lt;/i&gt;, ... }&lt;/code&gt;. In the first
<span class="lineNum">     277 </span>            :  *  form, keys and values occur in pairs, so there must be an even number of arguments.
<span class="lineNum">     278 </span>            :  *  The second and third form take a single argument which is either
<span class="lineNum">     279 </span>            :  *  an array of key-value pairs or an object convertible to a hash.
<span class="lineNum">     280 </span>            :  *
<span class="lineNum">     281 </span>            :  *     Hash[&quot;a&quot;, 100, &quot;b&quot;, 200]             #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}
<span class="lineNum">     282 </span>            :  *     Hash[ [ [&quot;a&quot;, 100], [&quot;b&quot;, 200] ] ]   #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}
<span class="lineNum">     283 </span>            :  *     Hash[&quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200]         #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}
<span class="lineNum">     284 </span>            :  */
<span class="lineNum">     285 </span>            : 
<a name="286"><span class="lineNum">     286 </span>            : static mrb_value</a>
<span class="lineNum">     287 </span>            : to_hash(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     288 </span><span class="lineCov">          2 : {</span>
<span class="lineNum">     289 </span><span class="lineCov">          2 :   return mrb_convert_type(mrb, hash, MRB_TT_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);</span>
<span class="lineNum">     290 </span>            : }
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span>            : /*
<span class="lineNum">     293 </span>            :  *  call-seq:
<span class="lineNum">     294 </span>            :  *     Hash.try_convert(obj) -&gt; hash or nil
<span class="lineNum">     295 </span>            :  *
<span class="lineNum">     296 </span>            :  *  Try to convert &lt;i&gt;obj&lt;/i&gt; into a hash, using to_hash method.
<span class="lineNum">     297 </span>            :  *  Returns converted hash or nil if &lt;i&gt;obj&lt;/i&gt; cannot be converted
<span class="lineNum">     298 </span>            :  *  for any reason.
<span class="lineNum">     299 </span>            :  *
<span class="lineNum">     300 </span>            :  *     Hash.try_convert({1=&gt;2})   # =&gt; {1=&gt;2}
<span class="lineNum">     301 </span>            :  *     Hash.try_convert(&quot;1=&gt;2&quot;)   # =&gt; nil
<span class="lineNum">     302 </span>            :  */
<span class="lineNum">     303 </span>            : 
<span class="lineNum">     304 </span>            : /* 15.2.13.4.2  */
<span class="lineNum">     305 </span>            : /*
<span class="lineNum">     306 </span>            :  *  call-seq:
<span class="lineNum">     307 </span>            :  *     hsh[key]    -&gt;  value
<span class="lineNum">     308 </span>            :  *
<span class="lineNum">     309 </span>            :  *  Element Reference---Retrieves the &lt;i&gt;value&lt;/i&gt; object corresponding
<span class="lineNum">     310 </span>            :  *  to the &lt;i&gt;key&lt;/i&gt; object. If not found, returns the default value (see
<span class="lineNum">     311 </span>            :  *  &lt;code&gt;Hash::new&lt;/code&gt; for details).
<span class="lineNum">     312 </span>            :  *
<span class="lineNum">     313 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     314 </span>            :  *     h[&quot;a&quot;]   #=&gt; 100
<span class="lineNum">     315 </span>            :  *     h[&quot;c&quot;]   #=&gt; nil
<span class="lineNum">     316 </span>            :  *
<span class="lineNum">     317 </span>            :  */
<a name="318"><span class="lineNum">     318 </span>            : mrb_value</a>
<span class="lineNum">     319 </span>            : mrb_hash_aget(mrb_state *mrb, mrb_value self)
<span class="lineNum">     320 </span><span class="lineCov">         53 : {</span>
<span class="lineNum">     321 </span>            :   mrb_value key;
<span class="lineNum">     322 </span>            : 
<span class="lineNum">     323 </span><span class="lineCov">         53 :   mrb_get_args(mrb, &quot;o&quot;, &amp;key);</span>
<span class="lineNum">     324 </span><span class="lineCov">         53 :   return mrb_hash_get(mrb, self, key);</span>
<span class="lineNum">     325 </span>            : }
<span class="lineNum">     326 </span>            : 
<a name="327"><span class="lineNum">     327 </span>            : mrb_value</a>
<span class="lineNum">     328 </span>            : mrb_hash_lookup(mrb_state *mrb, mrb_value hash, mrb_value key)
<span class="lineNum">     329 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :   return mrb_hash_get(mrb, hash, key);</span>
<span class="lineNum">     331 </span>            : }
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span>            : /*
<span class="lineNum">     334 </span>            :  *  call-seq:
<span class="lineNum">     335 </span>            :  *     hsh.fetch(key [, default] )       -&gt; obj
<span class="lineNum">     336 </span>            :  *     hsh.fetch(key) {| key | block }   -&gt; obj
<span class="lineNum">     337 </span>            :  *
<span class="lineNum">     338 </span>            :  *  Returns a value from the hash for the given key. If the key can't be
<span class="lineNum">     339 </span>            :  *  found, there are several options: With no other arguments, it will
<span class="lineNum">     340 </span>            :  *  raise an &lt;code&gt;KeyError&lt;/code&gt; exception; if &lt;i&gt;default&lt;/i&gt; is
<span class="lineNum">     341 </span>            :  *  given, then that will be returned; if the optional code block is
<span class="lineNum">     342 </span>            :  *  specified, then that will be run and its result returned.
<span class="lineNum">     343 </span>            :  *
<span class="lineNum">     344 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     345 </span>            :  *     h.fetch(&quot;a&quot;)                            #=&gt; 100
<span class="lineNum">     346 </span>            :  *     h.fetch(&quot;z&quot;, &quot;go fish&quot;)                 #=&gt; &quot;go fish&quot;
<span class="lineNum">     347 </span>            :  *     h.fetch(&quot;z&quot;) { |el| &quot;go fish, #{el}&quot;}   #=&gt; &quot;go fish, z&quot;
<span class="lineNum">     348 </span>            :  *
<span class="lineNum">     349 </span>            :  *  The following example shows that an exception is raised if the key
<span class="lineNum">     350 </span>            :  *  is not found and a default value is not supplied.
<span class="lineNum">     351 </span>            :  *
<span class="lineNum">     352 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     353 </span>            :  *     h.fetch(&quot;z&quot;)
<span class="lineNum">     354 </span>            :  *
<span class="lineNum">     355 </span>            :  *  &lt;em&gt;produces:&lt;/em&gt;
<span class="lineNum">     356 </span>            :  *
<span class="lineNum">     357 </span>            :  *     prog.rb:2:in `fetch': key not found (KeyError)
<span class="lineNum">     358 </span>            :  *      from prog.rb:2
<span class="lineNum">     359 </span>            :  *
<span class="lineNum">     360 </span>            :  */
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span>            : /* 15.2.13.4.5  */
<span class="lineNum">     363 </span>            : /*
<span class="lineNum">     364 </span>            :  *  call-seq:
<span class="lineNum">     365 </span>            :  *     hsh.default(key=nil)   -&gt; obj
<span class="lineNum">     366 </span>            :  *
<span class="lineNum">     367 </span>            :  *  Returns the default value, the value that would be returned by
<span class="lineNum">     368 </span>            :  *  &lt;i&gt;hsh&lt;/i&gt;[&lt;i&gt;key&lt;/i&gt;] if &lt;i&gt;key&lt;/i&gt; did not exist in &lt;i&gt;hsh&lt;/i&gt;.
<span class="lineNum">     369 </span>            :  *  See also &lt;code&gt;Hash::new&lt;/code&gt; and &lt;code&gt;Hash#default=&lt;/code&gt;.
<span class="lineNum">     370 </span>            :  *
<span class="lineNum">     371 </span>            :  *     h = Hash.new                            #=&gt; {}
<span class="lineNum">     372 </span>            :  *     h.default                               #=&gt; nil
<span class="lineNum">     373 </span>            :  *     h.default(2)                            #=&gt; nil
<span class="lineNum">     374 </span>            :  *
<span class="lineNum">     375 </span>            :  *     h = Hash.new(&quot;cat&quot;)                     #=&gt; {}
<span class="lineNum">     376 </span>            :  *     h.default                               #=&gt; &quot;cat&quot;
<span class="lineNum">     377 </span>            :  *     h.default(2)                            #=&gt; &quot;cat&quot;
<span class="lineNum">     378 </span>            :  *
<span class="lineNum">     379 </span>            :  *     h = Hash.new {|h,k| h[k] = k.to_i*10}   #=&gt; {}
<span class="lineNum">     380 </span>            :  *     h.default                               #=&gt; nil
<span class="lineNum">     381 </span>            :  *     h.default(2)                            #=&gt; 20
<span class="lineNum">     382 </span>            :  */
<span class="lineNum">     383 </span>            : 
<a name="384"><span class="lineNum">     384 </span>            : static mrb_value</a>
<span class="lineNum">     385 </span>            : mrb_hash_default(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     386 </span><span class="lineCov">          4 : {</span>
<span class="lineNum">     387 </span>            :   mrb_value *argv;
<span class="lineNum">     388 </span>            :   int argc;
<span class="lineNum">     389 </span>            :   mrb_value key;
<span class="lineNum">     390 </span>            : 
<span class="lineNum">     391 </span><span class="lineCov">          4 :   mrb_get_args(mrb, &quot;*&quot;, &amp;argv, &amp;argc);</span>
<span class="lineNum">     392 </span><span class="lineCov">          4 :   if (MRB_RHASH_PROCDEFAULT_P(hash)) {</span>
<span class="lineNum">     393 </span><span class="lineCov">          2 :     if (argc == 0) return mrb_nil_value();</span>
<span class="lineNum">     394 </span><span class="lineCov">          1 :     key = argv[0];</span>
<span class="lineNum">     395 </span><span class="lineCov">          1 :     return mrb_funcall(mrb, RHASH_PROCDEFAULT(hash), &quot;call&quot;, 2, hash, key);</span>
<span class="lineNum">     396 </span>            :   }
<span class="lineNum">     397 </span>            :   else {
<span class="lineNum">     398 </span><span class="lineCov">          2 :     return RHASH_IFNONE(hash);</span>
<span class="lineNum">     399 </span>            :   }
<span class="lineNum">     400 </span>            : }
<span class="lineNum">     401 </span>            : 
<span class="lineNum">     402 </span>            : /* 15.2.13.4.6  */
<span class="lineNum">     403 </span>            : /*
<span class="lineNum">     404 </span>            :  *  call-seq:
<span class="lineNum">     405 </span>            :  *     hsh.default = obj     -&gt; obj
<span class="lineNum">     406 </span>            :  *
<span class="lineNum">     407 </span>            :  *  Sets the default value, the value returned for a key that does not
<span class="lineNum">     408 </span>            :  *  exist in the hash. It is not possible to set the default to a
<span class="lineNum">     409 </span>            :  *  &lt;code&gt;Proc&lt;/code&gt; that will be executed on each key lookup.
<span class="lineNum">     410 </span>            :  *
<span class="lineNum">     411 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     412 </span>            :  *     h.default = &quot;Go fish&quot;
<span class="lineNum">     413 </span>            :  *     h[&quot;a&quot;]     #=&gt; 100
<span class="lineNum">     414 </span>            :  *     h[&quot;z&quot;]     #=&gt; &quot;Go fish&quot;
<span class="lineNum">     415 </span>            :  *     # This doesn't do what you might hope...
<span class="lineNum">     416 </span>            :  *     h.default = proc do |hash, key|
<span class="lineNum">     417 </span>            :  *       hash[key] = key + key
<span class="lineNum">     418 </span>            :  *     end
<span class="lineNum">     419 </span>            :  *     h[2]       #=&gt; #&lt;Proc:0x401b3948@-:6&gt;
<span class="lineNum">     420 </span>            :  *     h[&quot;cat&quot;]   #=&gt; #&lt;Proc:0x401b3948@-:6&gt;
<span class="lineNum">     421 </span>            :  */
<span class="lineNum">     422 </span>            : 
<a name="423"><span class="lineNum">     423 </span>            : static mrb_value</a>
<span class="lineNum">     424 </span>            : mrb_hash_set_default(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     425 </span><span class="lineCov">          1 : {</span>
<span class="lineNum">     426 </span>            :   mrb_value ifnone;
<span class="lineNum">     427 </span>            : 
<span class="lineNum">     428 </span><span class="lineCov">          1 :   mrb_get_args(mrb, &quot;o&quot;, &amp;ifnone);</span>
<span class="lineNum">     429 </span><span class="lineCov">          1 :   mrb_hash_modify(mrb, hash);</span>
<span class="lineNum">     430 </span><span class="lineCov">          1 :   mrb_iv_set(mrb, hash, mrb_intern2(mrb, &quot;ifnone&quot;, 6), ifnone);</span>
<span class="lineNum">     431 </span><span class="lineCov">          1 :   RHASH(hash)-&gt;flags &amp;= ~(MRB_HASH_PROC_DEFAULT);</span>
<span class="lineNum">     432 </span>            : 
<span class="lineNum">     433 </span><span class="lineCov">          1 :   return ifnone;</span>
<span class="lineNum">     434 </span>            : }
<span class="lineNum">     435 </span>            : 
<span class="lineNum">     436 </span>            : /* 15.2.13.4.7  */
<span class="lineNum">     437 </span>            : /*
<span class="lineNum">     438 </span>            :  *  call-seq:
<span class="lineNum">     439 </span>            :  *     hsh.default_proc -&gt; anObject
<span class="lineNum">     440 </span>            :  *
<span class="lineNum">     441 </span>            :  *  If &lt;code&gt;Hash::new&lt;/code&gt; was invoked with a block, return that
<span class="lineNum">     442 </span>            :  *  block, otherwise return &lt;code&gt;nil&lt;/code&gt;.
<span class="lineNum">     443 </span>            :  *
<span class="lineNum">     444 </span>            :  *     h = Hash.new {|h,k| h[k] = k*k }   #=&gt; {}
<span class="lineNum">     445 </span>            :  *     p = h.default_proc                 #=&gt; #&lt;Proc:0x401b3d08@-:1&gt;
<span class="lineNum">     446 </span>            :  *     a = []                             #=&gt; []
<span class="lineNum">     447 </span>            :  *     p.call(a, 2)
<span class="lineNum">     448 </span>            :  *     a                                  #=&gt; [nil, nil, 4]
<span class="lineNum">     449 </span>            :  */
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span>            : 
<a name="452"><span class="lineNum">     452 </span>            : static mrb_value</a>
<span class="lineNum">     453 </span>            : mrb_hash_default_proc(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     454 </span><span class="lineCov">          2 : {</span>
<span class="lineNum">     455 </span><span class="lineCov">          2 :   if (MRB_RHASH_PROCDEFAULT_P(hash)) {</span>
<span class="lineNum">     456 </span><span class="lineCov">          1 :     return RHASH_PROCDEFAULT(hash);</span>
<span class="lineNum">     457 </span>            :   }
<span class="lineNum">     458 </span><span class="lineCov">          1 :   return mrb_nil_value();</span>
<span class="lineNum">     459 </span>            : }
<span class="lineNum">     460 </span>            : 
<span class="lineNum">     461 </span>            : /*
<span class="lineNum">     462 </span>            :  *  call-seq:
<span class="lineNum">     463 </span>            :  *     hsh.default_proc = proc_obj     -&gt; proc_obj
<span class="lineNum">     464 </span>            :  *
<span class="lineNum">     465 </span>            :  *  Sets the default proc to be executed on each key lookup.
<span class="lineNum">     466 </span>            :  *
<span class="lineNum">     467 </span>            :  *     h.default_proc = proc do |hash, key|
<span class="lineNum">     468 </span>            :  *       hash[key] = key + key
<span class="lineNum">     469 </span>            :  *     end
<span class="lineNum">     470 </span>            :  *     h[2]       #=&gt; 4
<span class="lineNum">     471 </span>            :  *     h[&quot;cat&quot;]   #=&gt; &quot;catcat&quot;
<span class="lineNum">     472 </span>            :  */
<span class="lineNum">     473 </span>            : 
<a name="474"><span class="lineNum">     474 </span>            : static mrb_value</a>
<span class="lineNum">     475 </span>            : mrb_hash_set_default_proc(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     476 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     477 </span>            :   mrb_value ifnone;
<span class="lineNum">     478 </span>            : 
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :   mrb_get_args(mrb, &quot;o&quot;, &amp;ifnone);</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :   mrb_hash_modify(mrb, hash);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :   mrb_iv_set(mrb, hash, mrb_intern2(mrb, &quot;ifnone&quot;, 6), ifnone);</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :   RHASH(hash)-&gt;flags |= MRB_HASH_PROC_DEFAULT;</span>
<span class="lineNum">     483 </span>            : 
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :   return ifnone;</span>
<span class="lineNum">     485 </span>            : }
<span class="lineNum">     486 </span>            : 
<a name="487"><span class="lineNum">     487 </span>            : mrb_value</a>
<span class="lineNum">     488 </span>            : mrb_hash_delete_key(mrb_state *mrb, mrb_value hash, mrb_value key)
<span class="lineNum">     489 </span><span class="lineCov">          9 : {</span>
<span class="lineNum">     490 </span><span class="lineCov">          9 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     491 </span>            :   khiter_t k;
<span class="lineNum">     492 </span>            :   mrb_value delVal;
<span class="lineNum">     493 </span>            : 
<span class="lineNum">     494 </span><span class="lineCov">          9 :   if (h) {</span>
<span class="lineNum">     495 </span><span class="lineCov">          9 :     k = kh_get(ht, h, key);</span>
<span class="lineNum">     496 </span><span class="lineCov">          9 :     if (k != kh_end(h)) {</span>
<span class="lineNum">     497 </span><span class="lineCov">          8 :       delVal = kh_value(h, k);</span>
<span class="lineNum">     498 </span><span class="lineCov">          8 :       kh_del(ht, h, k);</span>
<span class="lineNum">     499 </span><span class="lineCov">          8 :       return delVal;</span>
<span class="lineNum">     500 </span>            :     }
<span class="lineNum">     501 </span>            :   }
<span class="lineNum">     502 </span>            : 
<span class="lineNum">     503 </span>            :   /* not found */
<span class="lineNum">     504 </span><span class="lineCov">          1 :   return mrb_nil_value();</span>
<span class="lineNum">     505 </span>            : }
<span class="lineNum">     506 </span>            : 
<span class="lineNum">     507 </span>            : /* 15.2.13.4.8  */
<span class="lineNum">     508 </span>            : /*
<span class="lineNum">     509 </span>            :  *  call-seq:
<span class="lineNum">     510 </span>            :  *     hsh.delete(key)                   -&gt; value
<span class="lineNum">     511 </span>            :  *     hsh.delete(key) {| key | block }  -&gt; value
<span class="lineNum">     512 </span>            :  *
<span class="lineNum">     513 </span>            :  *  Deletes and returns a key-value pair from &lt;i&gt;hsh&lt;/i&gt; whose key is
<span class="lineNum">     514 </span>            :  *  equal to &lt;i&gt;key&lt;/i&gt;. If the key is not found, returns the
<span class="lineNum">     515 </span>            :  *  &lt;em&gt;default value&lt;/em&gt;. If the optional code block is given and the
<span class="lineNum">     516 </span>            :  *  key is not found, pass in the key and return the result of
<span class="lineNum">     517 </span>            :  *  &lt;i&gt;block&lt;/i&gt;.
<span class="lineNum">     518 </span>            :  *
<span class="lineNum">     519 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     520 </span>            :  *     h.delete(&quot;a&quot;)                              #=&gt; 100
<span class="lineNum">     521 </span>            :  *     h.delete(&quot;z&quot;)                              #=&gt; nil
<span class="lineNum">     522 </span>            :  *     h.delete(&quot;z&quot;) { |el| &quot;#{el} not found&quot; }   #=&gt; &quot;z not found&quot;
<span class="lineNum">     523 </span>            :  *
<span class="lineNum">     524 </span>            :  */
<a name="525"><span class="lineNum">     525 </span>            : mrb_value</a>
<span class="lineNum">     526 </span>            : mrb_hash_delete(mrb_state *mrb, mrb_value self)
<span class="lineNum">     527 </span><span class="lineCov">          8 : {</span>
<span class="lineNum">     528 </span>            :   mrb_value key;
<span class="lineNum">     529 </span>            : 
<span class="lineNum">     530 </span><span class="lineCov">          8 :   mrb_get_args(mrb, &quot;o&quot;, &amp;key);</span>
<span class="lineNum">     531 </span><span class="lineCov">          8 :   return mrb_hash_delete_key(mrb, self, key);</span>
<span class="lineNum">     532 </span>            : }
<span class="lineNum">     533 </span>            : 
<span class="lineNum">     534 </span>            : /* 15.2.13.4.24 */
<span class="lineNum">     535 </span>            : /*
<span class="lineNum">     536 </span>            :  *  call-seq:
<span class="lineNum">     537 </span>            :  *     hsh.shift -&gt; anArray or obj
<span class="lineNum">     538 </span>            :  *
<span class="lineNum">     539 </span>            :  *  Removes a key-value pair from &lt;i&gt;hsh&lt;/i&gt; and returns it as the
<span class="lineNum">     540 </span>            :  *  two-item array &lt;code&gt;[&lt;/code&gt; &lt;i&gt;key, value&lt;/i&gt; &lt;code&gt;]&lt;/code&gt;, or
<span class="lineNum">     541 </span>            :  *  the hash's default value if the hash is empty.
<span class="lineNum">     542 </span>            :  *
<span class="lineNum">     543 </span>            :  *     h = { 1 =&gt; &quot;a&quot;, 2 =&gt; &quot;b&quot;, 3 =&gt; &quot;c&quot; }
<span class="lineNum">     544 </span>            :  *     h.shift   #=&gt; [1, &quot;a&quot;]
<span class="lineNum">     545 </span>            :  *     h         #=&gt; {2=&gt;&quot;b&quot;, 3=&gt;&quot;c&quot;}
<span class="lineNum">     546 </span>            :  */
<span class="lineNum">     547 </span>            : 
<a name="548"><span class="lineNum">     548 </span>            : static mrb_value</a>
<span class="lineNum">     549 </span>            : mrb_hash_shift(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     550 </span><span class="lineCov">          1 : {</span>
<span class="lineNum">     551 </span><span class="lineCov">          1 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     552 </span>            :   khiter_t k;
<span class="lineNum">     553 </span>            :   mrb_value delKey, delVal;
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span><span class="lineCov">          1 :   mrb_hash_modify(mrb, hash);</span>
<span class="lineNum">     556 </span><span class="lineCov">          1 :   if (h) {</span>
<span class="lineNum">     557 </span><span class="lineCov">          1 :     if (kh_size(h) &gt; 0) {</span>
<span class="lineNum">     558 </span><span class="lineCov">          2 :       for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">     559 </span><span class="lineCov">          2 :         if (!kh_exist(h,k)) continue;</span>
<span class="lineNum">     560 </span>            : 
<span class="lineNum">     561 </span><span class="lineCov">          1 :         delKey = kh_key(h,k);</span>
<span class="lineNum">     562 </span><span class="lineCov">          1 :         mrb_gc_protect(mrb, delKey);</span>
<span class="lineNum">     563 </span><span class="lineCov">          1 :         delVal = mrb_hash_delete_key(mrb, hash, delKey);</span>
<span class="lineNum">     564 </span><span class="lineCov">          1 :         mrb_gc_protect(mrb, delVal);</span>
<span class="lineNum">     565 </span>            : 
<span class="lineNum">     566 </span><span class="lineCov">          1 :         return mrb_assoc_new(mrb, delKey, delVal);</span>
<span class="lineNum">     567 </span>            :       }
<span class="lineNum">     568 </span>            :     }
<span class="lineNum">     569 </span>            :   }
<span class="lineNum">     570 </span>            : 
<span class="lineNum">     571 </span><span class="lineNoCov">          0 :   if (MRB_RHASH_PROCDEFAULT_P(hash)) {</span>
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :     return mrb_funcall(mrb, RHASH_PROCDEFAULT(hash), &quot;call&quot;, 2, hash, mrb_nil_value());</span>
<span class="lineNum">     573 </span>            :   }
<span class="lineNum">     574 </span>            :   else {
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :     return RHASH_IFNONE(hash);</span>
<span class="lineNum">     576 </span>            :   }
<span class="lineNum">     577 </span>            : }
<span class="lineNum">     578 </span>            : 
<span class="lineNum">     579 </span>            : /*
<span class="lineNum">     580 </span>            :  *  call-seq:
<span class="lineNum">     581 </span>            :  *     hsh.delete_if {| key, value | block }  -&gt; hsh
<span class="lineNum">     582 </span>            :  *     hsh.delete_if                          -&gt; an_enumerator
<span class="lineNum">     583 </span>            :  *
<span class="lineNum">     584 </span>            :  *  Deletes every key-value pair from &lt;i&gt;hsh&lt;/i&gt; for which &lt;i&gt;block&lt;/i&gt;
<span class="lineNum">     585 </span>            :  *  evaluates to &lt;code&gt;true&lt;/code&gt;.
<span class="lineNum">     586 </span>            :  *
<span class="lineNum">     587 </span>            :  *  If no block is given, an enumerator is returned instead.
<span class="lineNum">     588 </span>            :  *
<span class="lineNum">     589 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200, &quot;c&quot; =&gt; 300 }
<span class="lineNum">     590 </span>            :  *     h.delete_if {|key, value| key &gt;= &quot;b&quot; }   #=&gt; {&quot;a&quot;=&gt;100}
<span class="lineNum">     591 </span>            :  *
<span class="lineNum">     592 </span>            :  */
<span class="lineNum">     593 </span>            : 
<span class="lineNum">     594 </span>            : /*
<span class="lineNum">     595 </span>            :  *  call-seq:
<span class="lineNum">     596 </span>            :  *     hsh.reject! {| key, value | block }  -&gt; hsh or nil
<span class="lineNum">     597 </span>            :  *     hsh.reject!                          -&gt; an_enumerator
<span class="lineNum">     598 </span>            :  *
<span class="lineNum">     599 </span>            :  *  Equivalent to &lt;code&gt;Hash#delete_if&lt;/code&gt;, but returns
<span class="lineNum">     600 </span>            :  *  &lt;code&gt;nil&lt;/code&gt; if no changes were made.
<span class="lineNum">     601 </span>            :  */
<span class="lineNum">     602 </span>            : 
<span class="lineNum">     603 </span>            : /*
<span class="lineNum">     604 </span>            :  *  call-seq:
<span class="lineNum">     605 </span>            :  *     hsh.reject {| key, value | block }  -&gt; a_hash
<span class="lineNum">     606 </span>            :  *
<span class="lineNum">     607 </span>            :  *  Same as &lt;code&gt;Hash#delete_if&lt;/code&gt;, but works on (and returns) a
<span class="lineNum">     608 </span>            :  *  copy of the &lt;i&gt;hsh&lt;/i&gt;. Equivalent to
<span class="lineNum">     609 </span>            :  *  &lt;code&gt;&lt;i&gt;hsh&lt;/i&gt;.dup.delete_if&lt;/code&gt;.
<span class="lineNum">     610 </span>            :  *
<span class="lineNum">     611 </span>            :  */
<span class="lineNum">     612 </span>            : 
<span class="lineNum">     613 </span>            : /*
<span class="lineNum">     614 </span>            :  * call-seq:
<span class="lineNum">     615 </span>            :  *   hsh.values_at(key, ...)   -&gt; array
<span class="lineNum">     616 </span>            :  *
<span class="lineNum">     617 </span>            :  * Return an array containing the values associated with the given keys.
<span class="lineNum">     618 </span>            :  * Also see &lt;code&gt;Hash.select&lt;/code&gt;.
<span class="lineNum">     619 </span>            :  *
<span class="lineNum">     620 </span>            :  *   h = { &quot;cat&quot; =&gt; &quot;feline&quot;, &quot;dog&quot; =&gt; &quot;canine&quot;, &quot;cow&quot; =&gt; &quot;bovine&quot; }
<span class="lineNum">     621 </span>            :  *   h.values_at(&quot;cow&quot;, &quot;cat&quot;)  #=&gt; [&quot;bovine&quot;, &quot;feline&quot;]
<span class="lineNum">     622 </span>            :  */
<span class="lineNum">     623 </span>            : 
<a name="624"><span class="lineNum">     624 </span>            : mrb_value</a>
<span class="lineNum">     625 </span>            : mrb_hash_values_at(mrb_state *mrb, int argc, mrb_value *argv, mrb_value hash)
<span class="lineNum">     626 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :     mrb_value result = mrb_ary_new_capa(mrb, argc);</span>
<span class="lineNum">     628 </span>            :     long i;
<span class="lineNum">     629 </span>            : 
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :     for (i=0; i&lt;argc; i++) {</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :         mrb_ary_push(mrb, result, mrb_hash_get(mrb, hash, argv[i]));</span>
<span class="lineNum">     632 </span>            :     }
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :     return result;</span>
<span class="lineNum">     634 </span>            : }
<span class="lineNum">     635 </span>            : 
<span class="lineNum">     636 </span>            : /*
<span class="lineNum">     637 </span>            :  *  call-seq:
<span class="lineNum">     638 </span>            :  *     hsh.select {|key, value| block}   -&gt; a_hash
<span class="lineNum">     639 </span>            :  *     hsh.select                        -&gt; an_enumerator
<span class="lineNum">     640 </span>            :  *
<span class="lineNum">     641 </span>            :  *  Returns a new hash consisting of entries for which the block returns true.
<span class="lineNum">     642 </span>            :  *
<span class="lineNum">     643 </span>            :  *  If no block is given, an enumerator is returned instead.
<span class="lineNum">     644 </span>            :  *
<span class="lineNum">     645 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200, &quot;c&quot; =&gt; 300 }
<span class="lineNum">     646 </span>            :  *     h.select {|k,v| k &gt; &quot;a&quot;}  #=&gt; {&quot;b&quot; =&gt; 200, &quot;c&quot; =&gt; 300}
<span class="lineNum">     647 </span>            :  *     h.select {|k,v| v &lt; 200}  #=&gt; {&quot;a&quot; =&gt; 100}
<span class="lineNum">     648 </span>            :  */
<span class="lineNum">     649 </span>            : 
<span class="lineNum">     650 </span>            : /*
<span class="lineNum">     651 </span>            :  *  call-seq:
<span class="lineNum">     652 </span>            :  *     hsh.select! {| key, value | block }  -&gt; hsh or nil
<span class="lineNum">     653 </span>            :  *     hsh.select!                          -&gt; an_enumerator
<span class="lineNum">     654 </span>            :  *
<span class="lineNum">     655 </span>            :  *  Equivalent to &lt;code&gt;Hash#keep_if&lt;/code&gt;, but returns
<span class="lineNum">     656 </span>            :  *  &lt;code&gt;nil&lt;/code&gt; if no changes were made.
<span class="lineNum">     657 </span>            :  */
<span class="lineNum">     658 </span>            : 
<span class="lineNum">     659 </span>            : /*
<span class="lineNum">     660 </span>            :  *  call-seq:
<span class="lineNum">     661 </span>            :  *     hsh.keep_if {| key, value | block }  -&gt; hsh
<span class="lineNum">     662 </span>            :  *     hsh.keep_if                          -&gt; an_enumerator
<span class="lineNum">     663 </span>            :  *
<span class="lineNum">     664 </span>            :  *  Deletes every key-value pair from &lt;i&gt;hsh&lt;/i&gt; for which &lt;i&gt;block&lt;/i&gt;
<span class="lineNum">     665 </span>            :  *  evaluates to false.
<span class="lineNum">     666 </span>            :  *
<span class="lineNum">     667 </span>            :  *  If no block is given, an enumerator is returned instead.
<span class="lineNum">     668 </span>            :  *
<span class="lineNum">     669 </span>            :  */
<span class="lineNum">     670 </span>            : 
<span class="lineNum">     671 </span>            : /* 15.2.13.4.4  */
<span class="lineNum">     672 </span>            : /*
<span class="lineNum">     673 </span>            :  *  call-seq:
<span class="lineNum">     674 </span>            :  *     hsh.clear -&gt; hsh
<span class="lineNum">     675 </span>            :  *
<span class="lineNum">     676 </span>            :  *  Removes all key-value pairs from &lt;i&gt;hsh&lt;/i&gt;.
<span class="lineNum">     677 </span>            :  *
<span class="lineNum">     678 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }   #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}
<span class="lineNum">     679 </span>            :  *     h.clear                          #=&gt; {}
<span class="lineNum">     680 </span>            :  *
<span class="lineNum">     681 </span>            :  */
<span class="lineNum">     682 </span>            : 
<a name="683"><span class="lineNum">     683 </span>            : static mrb_value</a>
<span class="lineNum">     684 </span>            : mrb_hash_clear(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     685 </span><span class="lineCov">          3 : {</span>
<span class="lineNum">     686 </span><span class="lineCov">          3 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     687 </span>            : 
<span class="lineNum">     688 </span><span class="lineCov">          3 :   if (h) kh_clear(ht, h);</span>
<span class="lineNum">     689 </span><span class="lineCov">          3 :   return hash;</span>
<span class="lineNum">     690 </span>            : }
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span>            : /* 15.2.13.4.3  */
<span class="lineNum">     693 </span>            : /* 15.2.13.4.26 */
<span class="lineNum">     694 </span>            : /*
<span class="lineNum">     695 </span>            :  *  call-seq:
<span class="lineNum">     696 </span>            :  *     hsh[key] = value        -&gt; value
<span class="lineNum">     697 </span>            :  *     hsh.store(key, value)   -&gt; value
<span class="lineNum">     698 </span>            :  *
<span class="lineNum">     699 </span>            :  *  Element Assignment---Associates the value given by
<span class="lineNum">     700 </span>            :  *  &lt;i&gt;value&lt;/i&gt; with the key given by &lt;i&gt;key&lt;/i&gt;.
<span class="lineNum">     701 </span>            :  *  &lt;i&gt;key&lt;/i&gt; should not have its value changed while it is in
<span class="lineNum">     702 </span>            :  *  use as a key (a &lt;code&gt;String&lt;/code&gt; passed as a key will be
<span class="lineNum">     703 </span>            :  *  duplicated and frozen).
<span class="lineNum">     704 </span>            :  *
<span class="lineNum">     705 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     706 </span>            :  *     h[&quot;a&quot;] = 9
<span class="lineNum">     707 </span>            :  *     h[&quot;c&quot;] = 4
<span class="lineNum">     708 </span>            :  *     h   #=&gt; {&quot;a&quot;=&gt;9, &quot;b&quot;=&gt;200, &quot;c&quot;=&gt;4}
<span class="lineNum">     709 </span>            :  *
<span class="lineNum">     710 </span>            :  */
<a name="711"><span class="lineNum">     711 </span>            : mrb_value</a>
<span class="lineNum">     712 </span>            : mrb_hash_aset(mrb_state *mrb, mrb_value self)
<span class="lineNum">     713 </span><span class="lineCov">         25 : {</span>
<span class="lineNum">     714 </span>            :   mrb_value key, val;
<span class="lineNum">     715 </span>            : 
<span class="lineNum">     716 </span><span class="lineCov">         25 :   mrb_get_args(mrb, &quot;oo&quot;, &amp;key, &amp;val);</span>
<span class="lineNum">     717 </span><span class="lineCov">         25 :   mrb_hash_set(mrb, self, key, val);</span>
<span class="lineNum">     718 </span><span class="lineCov">         25 :   return val;</span>
<span class="lineNum">     719 </span>            : }
<span class="lineNum">     720 </span>            : 
<span class="lineNum">     721 </span>            : /* 15.2.13.4.17 */
<span class="lineNum">     722 </span>            : /* 15.2.13.4.23 */
<span class="lineNum">     723 </span>            : /*
<span class="lineNum">     724 </span>            :  *  call-seq:
<span class="lineNum">     725 </span>            :  *     hsh.replace(other_hash) -&gt; hsh
<span class="lineNum">     726 </span>            :  *
<span class="lineNum">     727 </span>            :  *  Replaces the contents of &lt;i&gt;hsh&lt;/i&gt; with the contents of
<span class="lineNum">     728 </span>            :  *  &lt;i&gt;other_hash&lt;/i&gt;.
<span class="lineNum">     729 </span>            :  *
<span class="lineNum">     730 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     731 </span>            :  *     h.replace({ &quot;c&quot; =&gt; 300, &quot;d&quot; =&gt; 400 })   #=&gt; {&quot;c&quot;=&gt;300, &quot;d&quot;=&gt;400}
<span class="lineNum">     732 </span>            :  *
<span class="lineNum">     733 </span>            :  */
<span class="lineNum">     734 </span>            : 
<a name="735"><span class="lineNum">     735 </span>            : static mrb_value</a>
<span class="lineNum">     736 </span>            : mrb_hash_replace(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     737 </span><span class="lineCov">          2 : {</span>
<span class="lineNum">     738 </span>            :   mrb_value hash2, ifnone;
<span class="lineNum">     739 </span>            :   khash_t(ht) *h2;
<span class="lineNum">     740 </span>            :   khiter_t k;
<span class="lineNum">     741 </span>            : 
<span class="lineNum">     742 </span><span class="lineCov">          2 :   mrb_get_args(mrb, &quot;o&quot;, &amp;hash2);</span>
<span class="lineNum">     743 </span><span class="lineCov">          2 :   hash2 = to_hash(mrb, hash2);</span>
<span class="lineNum">     744 </span><span class="lineCov">          2 :   if (mrb_obj_equal(mrb, hash, hash2)) return hash;</span>
<span class="lineNum">     745 </span><span class="lineCov">          2 :   mrb_hash_clear(mrb, hash);</span>
<span class="lineNum">     746 </span>            : 
<span class="lineNum">     747 </span><span class="lineCov">          2 :   h2 = RHASH_TBL(hash2);</span>
<span class="lineNum">     748 </span><span class="lineCov">          2 :   if (h2) {</span>
<span class="lineNum">     749 </span><span class="lineCov">         18 :     for (k = kh_begin(h2); k != kh_end(h2); k++) {</span>
<span class="lineNum">     750 </span><span class="lineCov">         16 :       if (kh_exist(h2, k))</span>
<span class="lineNum">     751 </span><span class="lineCov">          2 :         mrb_hash_set(mrb, hash, kh_key(h2, k), kh_value(h2, k));</span>
<span class="lineNum">     752 </span>            :     }
<span class="lineNum">     753 </span>            :   }
<span class="lineNum">     754 </span>            : 
<span class="lineNum">     755 </span><span class="lineCov">          2 :   if (MRB_RHASH_PROCDEFAULT_P(hash2)) {</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :     RHASH(hash)-&gt;flags |= MRB_HASH_PROC_DEFAULT;</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :     ifnone = RHASH_PROCDEFAULT(hash2);</span>
<span class="lineNum">     758 </span>            :   }
<span class="lineNum">     759 </span>            :   else {
<span class="lineNum">     760 </span><span class="lineCov">          2 :     ifnone = RHASH_IFNONE(hash2);</span>
<span class="lineNum">     761 </span>            :   }
<span class="lineNum">     762 </span><span class="lineCov">          2 :   mrb_iv_set(mrb, hash, mrb_intern2(mrb, &quot;ifnone&quot;, 6), ifnone);</span>
<span class="lineNum">     763 </span>            : 
<span class="lineNum">     764 </span><span class="lineCov">          2 :   return hash;</span>
<span class="lineNum">     765 </span>            : }
<span class="lineNum">     766 </span>            : 
<span class="lineNum">     767 </span>            : /* 15.2.13.4.20 */
<span class="lineNum">     768 </span>            : /* 15.2.13.4.25 */
<span class="lineNum">     769 </span>            : /*
<span class="lineNum">     770 </span>            :  *  call-seq:
<span class="lineNum">     771 </span>            :  *     hsh.length    -&gt;  fixnum
<span class="lineNum">     772 </span>            :  *     hsh.size      -&gt;  fixnum
<span class="lineNum">     773 </span>            :  *
<span class="lineNum">     774 </span>            :  *  Returns the number of key-value pairs in the hash.
<span class="lineNum">     775 </span>            :  *
<span class="lineNum">     776 </span>            :  *     h = { &quot;d&quot; =&gt; 100, &quot;a&quot; =&gt; 200, &quot;v&quot; =&gt; 300, &quot;e&quot; =&gt; 400 }
<span class="lineNum">     777 </span>            :  *     h.length        #=&gt; 4
<span class="lineNum">     778 </span>            :  *     h.delete(&quot;a&quot;)   #=&gt; 200
<span class="lineNum">     779 </span>            :  *     h.length        #=&gt; 3
<span class="lineNum">     780 </span>            :  */
<a name="781"><span class="lineNum">     781 </span>            : static mrb_value</a>
<span class="lineNum">     782 </span>            : mrb_hash_size_m(mrb_state *mrb, mrb_value self)
<span class="lineNum">     783 </span><span class="lineCov">          4 : {</span>
<span class="lineNum">     784 </span><span class="lineCov">          4 :   khash_t(ht) *h = RHASH_TBL(self);</span>
<span class="lineNum">     785 </span>            : 
<span class="lineNum">     786 </span><span class="lineCov">          4 :   if (!h) return mrb_fixnum_value(0);</span>
<span class="lineNum">     787 </span><span class="lineCov">          4 :   return mrb_fixnum_value(kh_size(h));</span>
<span class="lineNum">     788 </span>            : }
<span class="lineNum">     789 </span>            : 
<span class="lineNum">     790 </span>            : /* 15.2.13.4.12 */
<span class="lineNum">     791 </span>            : /*
<span class="lineNum">     792 </span>            :  *  call-seq:
<span class="lineNum">     793 </span>            :  *     hsh.empty?    -&gt; true or false
<span class="lineNum">     794 </span>            :  *
<span class="lineNum">     795 </span>            :  *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;hsh&lt;/i&gt; contains no key-value pairs.
<span class="lineNum">     796 </span>            :  *
<span class="lineNum">     797 </span>            :  *     {}.empty?   #=&gt; true
<span class="lineNum">     798 </span>            :  *
<span class="lineNum">     799 </span>            :  */
<a name="800"><span class="lineNum">     800 </span>            : static mrb_value</a>
<span class="lineNum">     801 </span>            : mrb_hash_empty_p(mrb_state *mrb, mrb_value self)
<span class="lineNum">     802 </span><span class="lineCov">          2 : {</span>
<span class="lineNum">     803 </span><span class="lineCov">          2 :   khash_t(ht) *h = RHASH_TBL(self);</span>
<span class="lineNum">     804 </span>            :   mrb_bool empty_p;
<span class="lineNum">     805 </span>            : 
<span class="lineNum">     806 </span><span class="lineCov">          2 :   if (h) {</span>
<span class="lineNum">     807 </span><span class="lineCov">          2 :     empty_p = (kh_size(h) == 0);</span>
<span class="lineNum">     808 </span>            :   }
<span class="lineNum">     809 </span>            :   else {
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :     empty_p = 1;</span>
<span class="lineNum">     811 </span>            :   }
<span class="lineNum">     812 </span>            : 
<span class="lineNum">     813 </span><span class="lineCov">          2 :   return mrb_bool_value(empty_p);</span>
<span class="lineNum">     814 </span>            : }
<span class="lineNum">     815 </span>            : 
<span class="lineNum">     816 </span>            : /* 15.2.13.4.11 */
<span class="lineNum">     817 </span>            : /*
<span class="lineNum">     818 </span>            :  *  call-seq:
<span class="lineNum">     819 </span>            :  *     hsh.each_value {| value | block } -&gt; hsh
<span class="lineNum">     820 </span>            :  *     hsh.each_value                    -&gt; an_enumerator
<span class="lineNum">     821 </span>            :  *
<span class="lineNum">     822 </span>            :  *  Calls &lt;i&gt;block&lt;/i&gt; once for each key in &lt;i&gt;hsh&lt;/i&gt;, passing the
<span class="lineNum">     823 </span>            :  *  value as a parameter.
<span class="lineNum">     824 </span>            :  *
<span class="lineNum">     825 </span>            :  *  If no block is given, an enumerator is returned instead.
<span class="lineNum">     826 </span>            :  *
<span class="lineNum">     827 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     828 </span>            :  *     h.each_value {|value| puts value }
<span class="lineNum">     829 </span>            :  *
<span class="lineNum">     830 </span>            :  *  &lt;em&gt;produces:&lt;/em&gt;
<span class="lineNum">     831 </span>            :  *
<span class="lineNum">     832 </span>            :  *     100
<span class="lineNum">     833 </span>            :  *     200
<span class="lineNum">     834 </span>            :  */
<span class="lineNum">     835 </span>            : 
<span class="lineNum">     836 </span>            : /* 15.2.13.4.10 */
<span class="lineNum">     837 </span>            : /*
<span class="lineNum">     838 </span>            :  *  call-seq:
<span class="lineNum">     839 </span>            :  *     hsh.each_key {| key | block } -&gt; hsh
<span class="lineNum">     840 </span>            :  *     hsh.each_key                  -&gt; an_enumerator
<span class="lineNum">     841 </span>            :  *
<span class="lineNum">     842 </span>            :  *  Calls &lt;i&gt;block&lt;/i&gt; once for each key in &lt;i&gt;hsh&lt;/i&gt;, passing the key
<span class="lineNum">     843 </span>            :  *  as a parameter.
<span class="lineNum">     844 </span>            :  *
<span class="lineNum">     845 </span>            :  *  If no block is given, an enumerator is returned instead.
<span class="lineNum">     846 </span>            :  *
<span class="lineNum">     847 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     848 </span>            :  *     h.each_key {|key| puts key }
<span class="lineNum">     849 </span>            :  *
<span class="lineNum">     850 </span>            :  *  &lt;em&gt;produces:&lt;/em&gt;
<span class="lineNum">     851 </span>            :  *
<span class="lineNum">     852 </span>            :  *     a
<span class="lineNum">     853 </span>            :  *     b
<span class="lineNum">     854 </span>            :  */
<span class="lineNum">     855 </span>            : 
<span class="lineNum">     856 </span>            : /* 15.2.13.4.9  */
<span class="lineNum">     857 </span>            : /*
<span class="lineNum">     858 </span>            :  *  call-seq:
<span class="lineNum">     859 </span>            :  *     hsh.each      {| key, value | block } -&gt; hsh
<span class="lineNum">     860 </span>            :  *     hsh.each_pair {| key, value | block } -&gt; hsh
<span class="lineNum">     861 </span>            :  *     hsh.each                              -&gt; an_enumerator
<span class="lineNum">     862 </span>            :  *     hsh.each_pair                         -&gt; an_enumerator
<span class="lineNum">     863 </span>            :  *
<span class="lineNum">     864 </span>            :  *  Calls &lt;i&gt;block&lt;/i&gt; once for each key in &lt;i&gt;hsh&lt;/i&gt;, passing the key-value
<span class="lineNum">     865 </span>            :  *  pair as parameters.
<span class="lineNum">     866 </span>            :  *
<span class="lineNum">     867 </span>            :  *  If no block is given, an enumerator is returned instead.
<span class="lineNum">     868 </span>            :  *
<span class="lineNum">     869 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">     870 </span>            :  *     h.each {|key, value| puts &quot;#{key} is #{value}&quot; }
<span class="lineNum">     871 </span>            :  *
<span class="lineNum">     872 </span>            :  *  &lt;em&gt;produces:&lt;/em&gt;
<span class="lineNum">     873 </span>            :  *
<span class="lineNum">     874 </span>            :  *     a is 100
<span class="lineNum">     875 </span>            :  *     b is 200
<span class="lineNum">     876 </span>            :  *
<span class="lineNum">     877 </span>            :  */
<span class="lineNum">     878 </span>            : 
<a name="879"><span class="lineNum">     879 </span>            : static mrb_value</a>
<span class="lineNum">     880 </span>            : inspect_hash(mrb_state *mrb, mrb_value hash, int recur)
<span class="lineNum">     881 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     882 </span>            :   mrb_value str, str2;
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     884 </span>            :   khiter_t k;
<span class="lineNum">     885 </span>            : 
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :   if (recur) return mrb_str_new(mrb, &quot;{...}&quot;, 5);</span>
<span class="lineNum">     887 </span>            : 
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :   str = mrb_str_new(mrb, &quot;{&quot;, 1);</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :   if (h &amp;&amp; kh_size(h) &gt; 0) {</span>
<span class="lineNum">     890 </span><span class="lineNoCov">          0 :     for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">     891 </span>            :       int ai;
<span class="lineNum">     892 </span>            : 
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :       if (!kh_exist(h,k)) continue;</span>
<span class="lineNum">     894 </span>            : 
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :       ai = mrb_gc_arena_save(mrb);</span>
<span class="lineNum">     896 </span>            : 
<span class="lineNum">     897 </span><span class="lineNoCov">          0 :       if (RSTRING_LEN(str) &gt; 1) mrb_str_cat(mrb, str, &quot;, &quot;, 2);</span>
<span class="lineNum">     898 </span>            : 
<span class="lineNum">     899 </span><span class="lineNoCov">          0 :       str2 = mrb_inspect(mrb, kh_key(h,k));</span>
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :       mrb_str_append(mrb, str, str2);</span>
<span class="lineNum">     901 </span><span class="lineNoCov">          0 :       mrb_str_buf_cat(mrb, str, &quot;=&gt;&quot;, 2);</span>
<span class="lineNum">     902 </span><span class="lineNoCov">          0 :       str2 = mrb_inspect(mrb, kh_value(h,k));</span>
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :       mrb_str_append(mrb, str, str2);</span>
<span class="lineNum">     904 </span>            : 
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :       mrb_gc_arena_restore(mrb, ai);</span>
<span class="lineNum">     906 </span>            :     }
<span class="lineNum">     907 </span>            :   }
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :   mrb_str_buf_cat(mrb, str, &quot;}&quot;, 1);</span>
<span class="lineNum">     909 </span>            : 
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :   return str;</span>
<span class="lineNum">     911 </span>            : }
<span class="lineNum">     912 </span>            : 
<span class="lineNum">     913 </span>            : /* 15.2.13.4.30 (x)*/
<span class="lineNum">     914 </span>            : /*
<span class="lineNum">     915 </span>            :  * call-seq:
<span class="lineNum">     916 </span>            :  *   hsh.to_s     -&gt; string
<span class="lineNum">     917 </span>            :  *   hsh.inspect  -&gt; string
<span class="lineNum">     918 </span>            :  *
<span class="lineNum">     919 </span>            :  * Return the contents of this hash as a string.
<span class="lineNum">     920 </span>            :  *
<span class="lineNum">     921 </span>            :  *     h = { &quot;c&quot; =&gt; 300, &quot;a&quot; =&gt; 100, &quot;d&quot; =&gt; 400, &quot;c&quot; =&gt; 300  }
<span class="lineNum">     922 </span>            :  *     h.to_s   #=&gt; &quot;{\&quot;c\&quot;=&gt;300, \&quot;a\&quot;=&gt;100, \&quot;d\&quot;=&gt;400}&quot;
<span class="lineNum">     923 </span>            :  */
<span class="lineNum">     924 </span>            : 
<a name="925"><span class="lineNum">     925 </span>            : static mrb_value</a>
<span class="lineNum">     926 </span>            : mrb_hash_inspect(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     927 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     929 </span>            : 
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :   if (!h || kh_size(h) == 0)</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :     return mrb_str_new(mrb, &quot;{}&quot;, 2);</span>
<span class="lineNum">     932 </span><span class="lineNoCov">          0 :   return inspect_hash(mrb, hash, 0);</span>
<span class="lineNum">     933 </span>            : }
<span class="lineNum">     934 </span>            : 
<span class="lineNum">     935 </span>            : /* 15.2.13.4.29 (x)*/
<span class="lineNum">     936 </span>            : /*
<span class="lineNum">     937 </span>            :  * call-seq:
<span class="lineNum">     938 </span>            :  *    hsh.to_hash   =&gt; hsh
<span class="lineNum">     939 </span>            :  *
<span class="lineNum">     940 </span>            :  * Returns +self+.
<span class="lineNum">     941 </span>            :  */
<span class="lineNum">     942 </span>            : 
<a name="943"><span class="lineNum">     943 </span>            : static mrb_value</a>
<span class="lineNum">     944 </span>            : mrb_hash_to_hash(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     945 </span><span class="lineCov">          2 : {</span>
<span class="lineNum">     946 </span><span class="lineCov">          2 :     return hash;</span>
<span class="lineNum">     947 </span>            : }
<span class="lineNum">     948 </span>            : 
<span class="lineNum">     949 </span>            : /* 15.2.13.4.19 */
<span class="lineNum">     950 </span>            : /*
<span class="lineNum">     951 </span>            :  *  call-seq:
<span class="lineNum">     952 </span>            :  *     hsh.keys    -&gt; array
<span class="lineNum">     953 </span>            :  *
<span class="lineNum">     954 </span>            :  *  Returns a new array populated with the keys from this hash. See also
<span class="lineNum">     955 </span>            :  *  &lt;code&gt;Hash#values&lt;/code&gt;.
<span class="lineNum">     956 </span>            :  *
<span class="lineNum">     957 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200, &quot;c&quot; =&gt; 300, &quot;d&quot; =&gt; 400 }
<span class="lineNum">     958 </span>            :  *     h.keys   #=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]
<span class="lineNum">     959 </span>            :  *
<span class="lineNum">     960 </span>            :  */
<span class="lineNum">     961 </span>            : 
<a name="962"><span class="lineNum">     962 </span>            : mrb_value</a>
<span class="lineNum">     963 </span>            : mrb_hash_keys(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     964 </span><span class="lineCov">         14 : {</span>
<span class="lineNum">     965 </span><span class="lineCov">         14 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     966 </span>            :   khiter_t k;
<span class="lineNum">     967 </span>            :   mrb_value ary;
<span class="lineNum">     968 </span>            : 
<span class="lineNum">     969 </span><span class="lineCov">         14 :   if (!h) return mrb_ary_new(mrb);</span>
<span class="lineNum">     970 </span><span class="lineCov">         14 :   ary = mrb_ary_new_capa(mrb, kh_size(h));</span>
<span class="lineNum">     971 </span><span class="lineCov">        126 :   for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">     972 </span><span class="lineCov">        112 :     if (kh_exist(h, k)) {</span>
<span class="lineNum">     973 </span><span class="lineCov">         32 :       mrb_value v = kh_key(h,k);</span>
<span class="lineNum">     974 </span><span class="lineCov">         32 :       mrb_ary_push(mrb, ary, v);</span>
<span class="lineNum">     975 </span>            :     }
<span class="lineNum">     976 </span>            :   }
<span class="lineNum">     977 </span><span class="lineCov">         14 :   return ary;</span>
<span class="lineNum">     978 </span>            : }
<span class="lineNum">     979 </span>            : 
<span class="lineNum">     980 </span>            : /* 15.2.13.4.28 */
<span class="lineNum">     981 </span>            : /*
<span class="lineNum">     982 </span>            :  *  call-seq:
<span class="lineNum">     983 </span>            :  *     hsh.values    -&gt; array
<span class="lineNum">     984 </span>            :  *
<span class="lineNum">     985 </span>            :  *  Returns a new array populated with the values from &lt;i&gt;hsh&lt;/i&gt;. See
<span class="lineNum">     986 </span>            :  *  also &lt;code&gt;Hash#keys&lt;/code&gt;.
<span class="lineNum">     987 </span>            :  *
<span class="lineNum">     988 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200, &quot;c&quot; =&gt; 300 }
<span class="lineNum">     989 </span>            :  *     h.values   #=&gt; [100, 200, 300]
<span class="lineNum">     990 </span>            :  *
<span class="lineNum">     991 </span>            :  */
<span class="lineNum">     992 </span>            : 
<a name="993"><span class="lineNum">     993 </span>            : static mrb_value</a>
<span class="lineNum">     994 </span>            : mrb_hash_values(mrb_state *mrb, mrb_value hash)
<span class="lineNum">     995 </span><span class="lineCov">          1 : {</span>
<span class="lineNum">     996 </span><span class="lineCov">          1 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">     997 </span>            :   khiter_t k;
<span class="lineNum">     998 </span>            :   mrb_value ary;
<span class="lineNum">     999 </span>            : 
<span class="lineNum">    1000 </span><span class="lineCov">          1 :   if (!h) return mrb_ary_new(mrb);</span>
<span class="lineNum">    1001 </span><span class="lineCov">          1 :   ary = mrb_ary_new_capa(mrb, kh_size(h));</span>
<span class="lineNum">    1002 </span><span class="lineCov">          9 :   for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">    1003 </span><span class="lineCov">          8 :     if (kh_exist(h, k)){</span>
<span class="lineNum">    1004 </span><span class="lineCov">          1 :       mrb_value v = kh_value(h,k);</span>
<span class="lineNum">    1005 </span><span class="lineCov">          1 :       mrb_ary_push(mrb, ary, v);</span>
<span class="lineNum">    1006 </span>            :     }
<span class="lineNum">    1007 </span>            :   }
<span class="lineNum">    1008 </span><span class="lineCov">          1 :   return ary;</span>
<span class="lineNum">    1009 </span>            : }
<span class="lineNum">    1010 </span>            : 
<a name="1011"><span class="lineNum">    1011 </span>            : static mrb_value</a>
<span class="lineNum">    1012 </span>            : mrb_hash_has_keyWithKey(mrb_state *mrb, mrb_value hash, mrb_value key)
<span class="lineNum">    1013 </span><span class="lineCov">         21 : {</span>
<span class="lineNum">    1014 </span><span class="lineCov">         21 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">    1015 </span>            :   khiter_t k;
<span class="lineNum">    1016 </span>            :   mrb_bool result;
<span class="lineNum">    1017 </span>            : 
<span class="lineNum">    1018 </span><span class="lineCov">         21 :   if (h) {</span>
<span class="lineNum">    1019 </span><span class="lineCov">         21 :     k = kh_get(ht, h, key);</span>
<span class="lineNum">    1020 </span><span class="lineCov">         21 :     result = (k != kh_end(h));</span>
<span class="lineNum">    1021 </span>            :   }
<span class="lineNum">    1022 </span>            :   else {
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :     result = 0;</span>
<span class="lineNum">    1024 </span>            :   }
<span class="lineNum">    1025 </span>            : 
<span class="lineNum">    1026 </span><span class="lineCov">         21 :   return mrb_bool_value(result);</span>
<span class="lineNum">    1027 </span>            : }
<span class="lineNum">    1028 </span>            : 
<span class="lineNum">    1029 </span>            : /* 15.2.13.4.13 */
<span class="lineNum">    1030 </span>            : /* 15.2.13.4.15 */
<span class="lineNum">    1031 </span>            : /* 15.2.13.4.18 */
<span class="lineNum">    1032 </span>            : /* 15.2.13.4.21 */
<span class="lineNum">    1033 </span>            : /*
<span class="lineNum">    1034 </span>            :  *  call-seq:
<span class="lineNum">    1035 </span>            :  *     hsh.has_key?(key)    -&gt; true or false
<span class="lineNum">    1036 </span>            :  *     hsh.include?(key)    -&gt; true or false
<span class="lineNum">    1037 </span>            :  *     hsh.key?(key)        -&gt; true or false
<span class="lineNum">    1038 </span>            :  *     hsh.member?(key)     -&gt; true or false
<span class="lineNum">    1039 </span>            :  *
<span class="lineNum">    1040 </span>            :  *  Returns &lt;code&gt;true&lt;/code&gt; if the given key is present in &lt;i&gt;hsh&lt;/i&gt;.
<span class="lineNum">    1041 </span>            :  *
<span class="lineNum">    1042 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">    1043 </span>            :  *     h.has_key?(&quot;a&quot;)   #=&gt; true
<span class="lineNum">    1044 </span>            :  *     h.has_key?(&quot;z&quot;)   #=&gt; false
<span class="lineNum">    1045 </span>            :  *
<span class="lineNum">    1046 </span>            :  */
<span class="lineNum">    1047 </span>            : 
<a name="1048"><span class="lineNum">    1048 </span>            : static mrb_value</a>
<span class="lineNum">    1049 </span>            : mrb_hash_has_key(mrb_state *mrb, mrb_value hash)
<span class="lineNum">    1050 </span><span class="lineCov">         21 : {</span>
<span class="lineNum">    1051 </span>            :   mrb_value key;
<span class="lineNum">    1052 </span>            : 
<span class="lineNum">    1053 </span><span class="lineCov">         21 :   mrb_get_args(mrb, &quot;o&quot;, &amp;key);</span>
<span class="lineNum">    1054 </span><span class="lineCov">         21 :   return mrb_hash_has_keyWithKey(mrb, hash, key);</span>
<span class="lineNum">    1055 </span>            : }
<span class="lineNum">    1056 </span>            : 
<a name="1057"><span class="lineNum">    1057 </span>            : static mrb_value</a>
<span class="lineNum">    1058 </span>            : mrb_hash_has_valueWithvalue(mrb_state *mrb, mrb_value hash, mrb_value value)
<span class="lineNum">    1059 </span><span class="lineCov">          4 : {</span>
<span class="lineNum">    1060 </span><span class="lineCov">          4 :   khash_t(ht) *h = RHASH_TBL(hash);</span>
<span class="lineNum">    1061 </span>            :   khiter_t k;
<span class="lineNum">    1062 </span>            : 
<span class="lineNum">    1063 </span><span class="lineCov">          4 :   if (h) {</span>
<span class="lineNum">    1064 </span><span class="lineCov">         80 :     for (k = kh_begin(h); k != kh_end(h); k++) {</span>
<span class="lineNum">    1065 </span><span class="lineCov">         78 :       if (!kh_exist(h, k)) continue;</span>
<span class="lineNum">    1066 </span>            : 
<span class="lineNum">    1067 </span><span class="lineCov">          2 :       if (mrb_equal(mrb, kh_value(h,k), value)) {</span>
<span class="lineNum">    1068 </span><span class="lineCov">          2 :         return mrb_true_value();</span>
<span class="lineNum">    1069 </span>            :       }
<span class="lineNum">    1070 </span>            :     }
<span class="lineNum">    1071 </span>            :   }
<span class="lineNum">    1072 </span>            : 
<span class="lineNum">    1073 </span><span class="lineCov">          2 :   return mrb_false_value();</span>
<span class="lineNum">    1074 </span>            : }
<span class="lineNum">    1075 </span>            : 
<span class="lineNum">    1076 </span>            : /* 15.2.13.4.14 */
<span class="lineNum">    1077 </span>            : /* 15.2.13.4.27 */
<span class="lineNum">    1078 </span>            : /*
<span class="lineNum">    1079 </span>            :  *  call-seq:
<span class="lineNum">    1080 </span>            :  *     hsh.has_value?(value)    -&gt; true or false
<span class="lineNum">    1081 </span>            :  *     hsh.value?(value)        -&gt; true or false
<span class="lineNum">    1082 </span>            :  *
<span class="lineNum">    1083 </span>            :  *  Returns &lt;code&gt;true&lt;/code&gt; if the given value is present for some key
<span class="lineNum">    1084 </span>            :  *  in &lt;i&gt;hsh&lt;/i&gt;.
<span class="lineNum">    1085 </span>            :  *
<span class="lineNum">    1086 </span>            :  *     h = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">    1087 </span>            :  *     h.has_value?(100)   #=&gt; true
<span class="lineNum">    1088 </span>            :  *     h.has_value?(999)   #=&gt; false
<span class="lineNum">    1089 </span>            :  */
<span class="lineNum">    1090 </span>            : 
<a name="1091"><span class="lineNum">    1091 </span>            : static mrb_value</a>
<span class="lineNum">    1092 </span>            : mrb_hash_has_value(mrb_state *mrb, mrb_value hash)
<span class="lineNum">    1093 </span><span class="lineCov">          4 : {</span>
<span class="lineNum">    1094 </span>            :   mrb_value val;
<span class="lineNum">    1095 </span>            : 
<span class="lineNum">    1096 </span><span class="lineCov">          4 :   mrb_get_args(mrb, &quot;o&quot;, &amp;val);</span>
<span class="lineNum">    1097 </span><span class="lineCov">          4 :   return mrb_hash_has_valueWithvalue(mrb, hash, val);</span>
<span class="lineNum">    1098 </span>            : }
<span class="lineNum">    1099 </span>            : 
<a name="1100"><span class="lineNum">    1100 </span>            : static mrb_value</a>
<span class="lineNum">    1101 </span>            : hash_equal(mrb_state *mrb, mrb_value hash1, mrb_value hash2, int eql)
<span class="lineNum">    1102 </span><span class="lineCov">         20 : {</span>
<span class="lineNum">    1103 </span>            :   khash_t(ht) *h1, *h2;
<span class="lineNum">    1104 </span>            : 
<span class="lineNum">    1105 </span><span class="lineCov">         20 :   if (mrb_obj_equal(mrb, hash1, hash2)) return mrb_true_value();</span>
<span class="lineNum">    1106 </span><span class="lineCov">         20 :   if (!mrb_hash_p(hash2)) {</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :       if (!mrb_respond_to(mrb, hash2, mrb_intern2(mrb, &quot;to_hash&quot;, 7))) {</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :           return mrb_false_value();</span>
<span class="lineNum">    1109 </span>            :       }
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :       if (eql)</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">          0 :           return mrb_fixnum_value(mrb_eql(mrb, hash2, hash1));</span>
<span class="lineNum">    1112 </span>            :       else
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :           return mrb_fixnum_value(mrb_equal(mrb, hash2, hash1));</span>
<span class="lineNum">    1114 </span>            :   }
<span class="lineNum">    1115 </span><span class="lineCov">         20 :   h1 = RHASH_TBL(hash1);</span>
<span class="lineNum">    1116 </span><span class="lineCov">         20 :   h2 = RHASH_TBL(hash2);</span>
<span class="lineNum">    1117 </span><span class="lineCov">         20 :   if (!h1) {</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :     return mrb_bool_value(!h2);</span>
<span class="lineNum">    1119 </span>            :   }
<span class="lineNum">    1120 </span><span class="lineCov">         20 :   if (!h2) return mrb_false_value();</span>
<span class="lineNum">    1121 </span><span class="lineCov">         20 :   if (kh_size(h1) != kh_size(h2)) return mrb_false_value();</span>
<span class="lineNum">    1122 </span>            :   else {
<span class="lineNum">    1123 </span>            :     khiter_t k1, k2;
<span class="lineNum">    1124 </span>            :     mrb_value key;
<span class="lineNum">    1125 </span>            : 
<span class="lineNum">    1126 </span><span class="lineCov">        345 :     for (k1 = kh_begin(h1); k1 != kh_end(h1); k1++) {</span>
<span class="lineNum">    1127 </span><span class="lineCov">        326 :       if (!kh_exist(h1, k1)) continue;</span>
<span class="lineNum">    1128 </span><span class="lineCov">         38 :       key = kh_key(h1,k1);</span>
<span class="lineNum">    1129 </span><span class="lineCov">         38 :       k2 = kh_get(ht, h2, key);</span>
<span class="lineNum">    1130 </span><span class="lineCov">         38 :       if (k2 != kh_end(h2)) {</span>
<span class="lineNum">    1131 </span><span class="lineCov">         37 :         if (mrb_equal(mrb, kh_value(h1,k1), kh_value(h2,k2))) {</span>
<span class="lineNum">    1132 </span><span class="lineCov">         37 :           continue; /* next key */</span>
<span class="lineNum">    1133 </span>            :         }
<span class="lineNum">    1134 </span>            :       }
<span class="lineNum">    1135 </span><span class="lineCov">          1 :       return mrb_false_value();</span>
<span class="lineNum">    1136 </span>            :     }
<span class="lineNum">    1137 </span>            :   }
<span class="lineNum">    1138 </span><span class="lineCov">         19 :   return mrb_true_value();</span>
<span class="lineNum">    1139 </span>            : }
<span class="lineNum">    1140 </span>            : 
<span class="lineNum">    1141 </span>            : /* 15.2.13.4.1  */
<span class="lineNum">    1142 </span>            : /*
<span class="lineNum">    1143 </span>            :  *  call-seq:
<span class="lineNum">    1144 </span>            :  *     hsh == other_hash    -&gt; true or false
<span class="lineNum">    1145 </span>            :  *
<span class="lineNum">    1146 </span>            :  *  Equality---Two hashes are equal if they each contain the same number
<span class="lineNum">    1147 </span>            :  *  of keys and if each key-value pair is equal to (according to
<span class="lineNum">    1148 </span>            :  *  &lt;code&gt;Object#==&lt;/code&gt;) the corresponding elements in the other
<span class="lineNum">    1149 </span>            :  *  hash.
<span class="lineNum">    1150 </span>            :  *
<span class="lineNum">    1151 </span>            :  *     h1 = { &quot;a&quot; =&gt; 1, &quot;c&quot; =&gt; 2 }
<span class="lineNum">    1152 </span>            :  *     h2 = { 7 =&gt; 35, &quot;c&quot; =&gt; 2, &quot;a&quot; =&gt; 1 }
<span class="lineNum">    1153 </span>            :  *     h3 = { &quot;a&quot; =&gt; 1, &quot;c&quot; =&gt; 2, 7 =&gt; 35 }
<span class="lineNum">    1154 </span>            :  *     h4 = { &quot;a&quot; =&gt; 1, &quot;d&quot; =&gt; 2, &quot;f&quot; =&gt; 35 }
<span class="lineNum">    1155 </span>            :  *     h1 == h2   #=&gt; false
<span class="lineNum">    1156 </span>            :  *     h2 == h3   #=&gt; true
<span class="lineNum">    1157 </span>            :  *     h3 == h4   #=&gt; false
<span class="lineNum">    1158 </span>            :  *
<span class="lineNum">    1159 </span>            :  */
<span class="lineNum">    1160 </span>            : 
<a name="1161"><span class="lineNum">    1161 </span>            : static mrb_value</a>
<span class="lineNum">    1162 </span>            : mrb_hash_equal(mrb_state *mrb, mrb_value hash1)
<span class="lineNum">    1163 </span><span class="lineCov">         20 : {</span>
<span class="lineNum">    1164 </span>            :   mrb_value hash2;
<span class="lineNum">    1165 </span>            : 
<span class="lineNum">    1166 </span><span class="lineCov">         20 :   mrb_get_args(mrb, &quot;o&quot;, &amp;hash2);</span>
<span class="lineNum">    1167 </span><span class="lineCov">         20 :   return hash_equal(mrb, hash1, hash2, FALSE);</span>
<span class="lineNum">    1168 </span>            : }
<span class="lineNum">    1169 </span>            : 
<span class="lineNum">    1170 </span>            : /* 15.2.13.4.32 (x)*/
<span class="lineNum">    1171 </span>            : /*
<span class="lineNum">    1172 </span>            :  *  call-seq:
<span class="lineNum">    1173 </span>            :  *     hash.eql?(other)  -&gt; true or false
<span class="lineNum">    1174 </span>            :  *
<span class="lineNum">    1175 </span>            :  *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;hash&lt;/i&gt; and &lt;i&gt;other&lt;/i&gt; are
<span class="lineNum">    1176 </span>            :  *  both hashes with the same content.
<span class="lineNum">    1177 </span>            :  */
<span class="lineNum">    1178 </span>            : 
<a name="1179"><span class="lineNum">    1179 </span>            : static mrb_value</a>
<span class="lineNum">    1180 </span>            : mrb_hash_eql(mrb_state *mrb, mrb_value hash1)
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">    1182 </span>            :   mrb_value hash2;
<span class="lineNum">    1183 </span>            : 
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :   mrb_get_args(mrb, &quot;o&quot;, &amp;hash2);</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :   return hash_equal(mrb, hash1, hash2, TRUE);</span>
<span class="lineNum">    1186 </span>            : }
<span class="lineNum">    1187 </span>            : 
<span class="lineNum">    1188 </span>            : /*
<span class="lineNum">    1189 </span>            :  *  call-seq:
<span class="lineNum">    1190 </span>            :  *     hsh.merge!(other_hash)                                 -&gt; hsh
<span class="lineNum">    1191 </span>            :  *     hsh.update(other_hash)                                 -&gt; hsh
<span class="lineNum">    1192 </span>            :  *     hsh.merge!(other_hash){|key, oldval, newval| block}    -&gt; hsh
<span class="lineNum">    1193 </span>            :  *     hsh.update(other_hash){|key, oldval, newval| block}    -&gt; hsh
<span class="lineNum">    1194 </span>            :  *
<span class="lineNum">    1195 </span>            :  *  Adds the contents of &lt;i&gt;other_hash&lt;/i&gt; to &lt;i&gt;hsh&lt;/i&gt;.  If no
<span class="lineNum">    1196 </span>            :  *  block is specified, entries with duplicate keys are overwritten
<span class="lineNum">    1197 </span>            :  *  with the values from &lt;i&gt;other_hash&lt;/i&gt;, otherwise the value
<span class="lineNum">    1198 </span>            :  *  of each duplicate key is determined by calling the block with
<span class="lineNum">    1199 </span>            :  *  the key, its value in &lt;i&gt;hsh&lt;/i&gt; and its value in &lt;i&gt;other_hash&lt;/i&gt;.
<span class="lineNum">    1200 </span>            :  *
<span class="lineNum">    1201 </span>            :  *     h1 = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">    1202 </span>            :  *     h2 = { &quot;b&quot; =&gt; 254, &quot;c&quot; =&gt; 300 }
<span class="lineNum">    1203 </span>            :  *     h1.merge!(h2)   #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;254, &quot;c&quot;=&gt;300}
<span class="lineNum">    1204 </span>            :  *
<span class="lineNum">    1205 </span>            :  *     h1 = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">    1206 </span>            :  *     h2 = { &quot;b&quot; =&gt; 254, &quot;c&quot; =&gt; 300 }
<span class="lineNum">    1207 </span>            :  *     h1.merge!(h2) { |key, v1, v2| v1 }
<span class="lineNum">    1208 </span>            :  *                     #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200, &quot;c&quot;=&gt;300}
<span class="lineNum">    1209 </span>            :  */
<span class="lineNum">    1210 </span>            : 
<span class="lineNum">    1211 </span>            : /* 15.2.13.4.22 */
<span class="lineNum">    1212 </span>            : /*
<span class="lineNum">    1213 </span>            :  *  call-seq:
<span class="lineNum">    1214 </span>            :  *     hsh.merge(other_hash)                              -&gt; new_hash
<span class="lineNum">    1215 </span>            :  *     hsh.merge(other_hash){|key, oldval, newval| block} -&gt; new_hash
<span class="lineNum">    1216 </span>            :  *
<span class="lineNum">    1217 </span>            :  *  Returns a new hash containing the contents of &lt;i&gt;other_hash&lt;/i&gt; and
<span class="lineNum">    1218 </span>            :  *  the contents of &lt;i&gt;hsh&lt;/i&gt;. If no block is specified, the value for
<span class="lineNum">    1219 </span>            :  *  entries with duplicate keys will be that of &lt;i&gt;other_hash&lt;/i&gt;. Otherwise
<span class="lineNum">    1220 </span>            :  *  the value for each duplicate key is determined by calling the block
<span class="lineNum">    1221 </span>            :  *  with the key, its value in &lt;i&gt;hsh&lt;/i&gt; and its value in &lt;i&gt;other_hash&lt;/i&gt;.
<span class="lineNum">    1222 </span>            :  *
<span class="lineNum">    1223 </span>            :  *     h1 = { &quot;a&quot; =&gt; 100, &quot;b&quot; =&gt; 200 }
<span class="lineNum">    1224 </span>            :  *     h2 = { &quot;b&quot; =&gt; 254, &quot;c&quot; =&gt; 300 }
<span class="lineNum">    1225 </span>            :  *     h1.merge(h2)   #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;254, &quot;c&quot;=&gt;300}
<span class="lineNum">    1226 </span>            :  *     h1.merge(h2){|key, oldval, newval| newval - oldval}
<span class="lineNum">    1227 </span>            :  *                    #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;54,  &quot;c&quot;=&gt;300}
<span class="lineNum">    1228 </span>            :  *     h1             #=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}
<span class="lineNum">    1229 </span>            :  *
<span class="lineNum">    1230 </span>            :  */
<span class="lineNum">    1231 </span>            : 
<span class="lineNum">    1232 </span>            : /*
<span class="lineNum">    1233 </span>            :  *  call-seq:
<span class="lineNum">    1234 </span>            :  *     hash.assoc(obj)   -&gt;  an_array  or  nil
<span class="lineNum">    1235 </span>            :  *
<span class="lineNum">    1236 </span>            :  *  Searches through the hash comparing _obj_ with the key using &lt;code&gt;==&lt;/code&gt;.
<span class="lineNum">    1237 </span>            :  *  Returns the key-value pair (two elements array) or +nil+
<span class="lineNum">    1238 </span>            :  *  if no match is found.  See &lt;code&gt;Array#assoc&lt;/code&gt;.
<span class="lineNum">    1239 </span>            :  *
<span class="lineNum">    1240 </span>            :  *     h = {&quot;colors&quot;  =&gt; [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;],
<span class="lineNum">    1241 </span>            :  *          &quot;letters&quot; =&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot; ]}
<span class="lineNum">    1242 </span>            :  *     h.assoc(&quot;letters&quot;)  #=&gt; [&quot;letters&quot;, [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]]
<span class="lineNum">    1243 </span>            :  *     h.assoc(&quot;foo&quot;)      #=&gt; nil
<span class="lineNum">    1244 </span>            :  */
<span class="lineNum">    1245 </span>            : 
<a name="1246"><span class="lineNum">    1246 </span>            : mrb_value</a>
<span class="lineNum">    1247 </span>            : mrb_hash_assoc(mrb_state *mrb, mrb_value hash)
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">    1249 </span>            :   mrb_value key, value, has_key;
<span class="lineNum">    1250 </span>            : 
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :   mrb_get_args(mrb, &quot;o&quot;, &amp;key);</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :   if (mrb_nil_p(key))</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :     mrb_raise(mrb, E_ARGUMENT_ERROR, &quot;wrong number of arguments&quot;);</span>
<span class="lineNum">    1254 </span>            : 
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :   has_key = mrb_hash_has_keyWithKey(mrb, hash, key);</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :   if (mrb_test(has_key)) {</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :     value = mrb_hash_get(mrb, hash, key);</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :     return mrb_assoc_new(mrb, key, value);</span>
<span class="lineNum">    1259 </span>            :   }
<span class="lineNum">    1260 </span>            :   else {
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :     return mrb_nil_value();</span>
<span class="lineNum">    1262 </span>            :   }
<span class="lineNum">    1263 </span>            : }
<span class="lineNum">    1264 </span>            : 
<span class="lineNum">    1265 </span>            : /*
<span class="lineNum">    1266 </span>            :  *  call-seq:
<span class="lineNum">    1267 </span>            :  *     hash.rassoc(key) -&gt; an_array or nil
<span class="lineNum">    1268 </span>            :  *
<span class="lineNum">    1269 </span>            :  *  Searches through the hash comparing _obj_ with the value using &lt;code&gt;==&lt;/code&gt;.
<span class="lineNum">    1270 </span>            :  *  Returns the first key-value pair (two-element array) that matches. See
<span class="lineNum">    1271 </span>            :  *  also &lt;code&gt;Array#rassoc&lt;/code&gt;.
<span class="lineNum">    1272 </span>            :  *
<span class="lineNum">    1273 </span>            :  *     a = {1=&gt; &quot;one&quot;, 2 =&gt; &quot;two&quot;, 3 =&gt; &quot;three&quot;, &quot;ii&quot; =&gt; &quot;two&quot;}
<span class="lineNum">    1274 </span>            :  *     a.rassoc(&quot;two&quot;)    #=&gt; [2, &quot;two&quot;]
<span class="lineNum">    1275 </span>            :  *     a.rassoc(&quot;four&quot;)   #=&gt; nil
<span class="lineNum">    1276 </span>            :  */
<span class="lineNum">    1277 </span>            : 
<a name="1278"><span class="lineNum">    1278 </span>            : mrb_value</a>
<span class="lineNum">    1279 </span>            : mrb_hash_rassoc(mrb_state *mrb, mrb_value hash)
<span class="lineNum">    1280 </span><span class="lineNoCov">          0 : {</span>
<span class="lineNum">    1281 </span>            :   mrb_value key, value, has_key;
<span class="lineNum">    1282 </span>            : 
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :   mrb_get_args(mrb, &quot;o&quot;, &amp;key);</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :   has_key = mrb_hash_has_keyWithKey(mrb, hash, key);</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :   if (mrb_test(has_key)) {</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :     value = mrb_hash_get(mrb, hash, key);</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :     return mrb_assoc_new(mrb, value, key);</span>
<span class="lineNum">    1288 </span>            :   }
<span class="lineNum">    1289 </span>            :   else {
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :     return mrb_nil_value();</span>
<span class="lineNum">    1291 </span>            :   }
<span class="lineNum">    1292 </span>            : }
<span class="lineNum">    1293 </span>            : 
<span class="lineNum">    1294 </span>            : /*
<span class="lineNum">    1295 </span>            :  *  call-seq:
<span class="lineNum">    1296 </span>            :  *     hash.flatten -&gt; an_array
<span class="lineNum">    1297 </span>            :  *     hash.flatten(level) -&gt; an_array
<span class="lineNum">    1298 </span>            :  *
<span class="lineNum">    1299 </span>            :  *  Returns a new array that is a one-dimensional flattening of this
<span class="lineNum">    1300 </span>            :  *  hash. That is, for every key or value that is an array, extract
<span class="lineNum">    1301 </span>            :  *  its elements into the new array.  Unlike Array#flatten, this
<span class="lineNum">    1302 </span>            :  *  method does not flatten recursively by default.  The optional
<span class="lineNum">    1303 </span>            :  *  &lt;i&gt;level&lt;/i&gt; argument determines the level of recursion to flatten.
<span class="lineNum">    1304 </span>            :  *
<span class="lineNum">    1305 </span>            :  *     a =  {1=&gt; &quot;one&quot;, 2 =&gt; [2,&quot;two&quot;], 3 =&gt; &quot;three&quot;}
<span class="lineNum">    1306 </span>            :  *     a.flatten    # =&gt; [1, &quot;one&quot;, 2, [2, &quot;two&quot;], 3, &quot;three&quot;]
<span class="lineNum">    1307 </span>            :  *     a.flatten(2) # =&gt; [1, &quot;one&quot;, 2, 2, &quot;two&quot;, 3, &quot;three&quot;]
<span class="lineNum">    1308 </span>            :  */
<span class="lineNum">    1309 </span>            : 
<span class="lineNum">    1310 </span>            : /*
<span class="lineNum">    1311 </span>            :  *  A &lt;code&gt;Hash&lt;/code&gt; is a collection of key-value pairs. It is
<span class="lineNum">    1312 </span>            :  *  similar to an &lt;code&gt;Array&lt;/code&gt;, except that indexing is done via
<span class="lineNum">    1313 </span>            :  *  arbitrary keys of any object type, not an integer index. Hashes enumerate
<span class="lineNum">    1314 </span>            :  *  their values in the order that the corresponding keys were inserted.
<span class="lineNum">    1315 </span>            :  *
<span class="lineNum">    1316 </span>            :  *  Hashes have a &lt;em&gt;default value&lt;/em&gt; that is returned when accessing
<span class="lineNum">    1317 </span>            :  *  keys that do not exist in the hash. By default, that value is
<span class="lineNum">    1318 </span>            :  *  &lt;code&gt;nil&lt;/code&gt;.
<span class="lineNum">    1319 </span>            :  *
<span class="lineNum">    1320 </span>            :  */
<span class="lineNum">    1321 </span>            : 
<a name="1322"><span class="lineNum">    1322 </span>            : void</a>
<span class="lineNum">    1323 </span>            : mrb_init_hash(mrb_state *mrb)
<span class="lineNum">    1324 </span><span class="lineCov">         53 : {</span>
<span class="lineNum">    1325 </span>            :   struct RClass *h;
<span class="lineNum">    1326 </span>            : 
<span class="lineNum">    1327 </span><span class="lineCov">         53 :   h = mrb-&gt;hash_class = mrb_define_class(mrb, &quot;Hash&quot;, mrb-&gt;object_class);</span>
<span class="lineNum">    1328 </span><span class="lineCov">         53 :   MRB_SET_INSTANCE_TT(h, MRB_TT_HASH);</span>
<span class="lineNum">    1329 </span>            : 
<span class="lineNum">    1330 </span><span class="lineCov">         53 :   mrb_include_module(mrb, h, mrb_class_get(mrb, &quot;Enumerable&quot;));</span>
<span class="lineNum">    1331 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;==&quot;,              mrb_hash_equal,       MRB_ARGS_REQ(1)); /* 15.2.13.4.1  */</span>
<span class="lineNum">    1332 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;[]&quot;,              mrb_hash_aget,        MRB_ARGS_REQ(1)); /* 15.2.13.4.2  */</span>
<span class="lineNum">    1333 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;[]=&quot;,             mrb_hash_aset,        MRB_ARGS_REQ(2)); /* 15.2.13.4.3  */</span>
<span class="lineNum">    1334 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;clear&quot;,           mrb_hash_clear,       MRB_ARGS_NONE()); /* 15.2.13.4.4  */</span>
<span class="lineNum">    1335 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;default&quot;,         mrb_hash_default,     MRB_ARGS_ANY());  /* 15.2.13.4.5  */</span>
<span class="lineNum">    1336 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;default=&quot;,        mrb_hash_set_default, MRB_ARGS_REQ(1)); /* 15.2.13.4.6  */</span>
<span class="lineNum">    1337 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;default_proc&quot;,    mrb_hash_default_proc,MRB_ARGS_NONE()); /* 15.2.13.4.7  */</span>
<span class="lineNum">    1338 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;default_proc=&quot;,   mrb_hash_set_default_proc,MRB_ARGS_REQ(1)); /* 15.2.13.4.7  */</span>
<span class="lineNum">    1339 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;__delete&quot;,        mrb_hash_delete,      MRB_ARGS_REQ(1)); /* core of 15.2.13.4.8  */</span>
<span class="lineNum">    1340 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;empty?&quot;,          mrb_hash_empty_p,     MRB_ARGS_NONE()); /* 15.2.13.4.12 */</span>
<span class="lineNum">    1341 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;has_key?&quot;,        mrb_hash_has_key,     MRB_ARGS_REQ(1)); /* 15.2.13.4.13 */</span>
<span class="lineNum">    1342 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;has_value?&quot;,      mrb_hash_has_value,   MRB_ARGS_REQ(1)); /* 15.2.13.4.14 */</span>
<span class="lineNum">    1343 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;include?&quot;,        mrb_hash_has_key,     MRB_ARGS_REQ(1)); /* 15.2.13.4.15 */</span>
<span class="lineNum">    1344 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;__init_core&quot;,     mrb_hash_init_core,   MRB_ARGS_ANY());  /* core of 15.2.13.4.16 */</span>
<span class="lineNum">    1345 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;initialize_copy&quot;, mrb_hash_replace,     MRB_ARGS_REQ(1)); /* 15.2.13.4.17 */</span>
<span class="lineNum">    1346 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;key?&quot;,            mrb_hash_has_key,     MRB_ARGS_REQ(1)); /* 15.2.13.4.18 */</span>
<span class="lineNum">    1347 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;keys&quot;,            mrb_hash_keys,        MRB_ARGS_NONE()); /* 15.2.13.4.19 */</span>
<span class="lineNum">    1348 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;length&quot;,          mrb_hash_size_m,      MRB_ARGS_NONE()); /* 15.2.13.4.20 */</span>
<span class="lineNum">    1349 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;member?&quot;,         mrb_hash_has_key,     MRB_ARGS_REQ(1)); /* 15.2.13.4.21 */</span>
<span class="lineNum">    1350 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;replace&quot;,         mrb_hash_replace,     MRB_ARGS_REQ(1)); /* 15.2.13.4.23 */</span>
<span class="lineNum">    1351 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;shift&quot;,           mrb_hash_shift,       MRB_ARGS_NONE()); /* 15.2.13.4.24 */</span>
<span class="lineNum">    1352 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;size&quot;,            mrb_hash_size_m,      MRB_ARGS_NONE()); /* 15.2.13.4.25 */</span>
<span class="lineNum">    1353 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;store&quot;,           mrb_hash_aset,        MRB_ARGS_REQ(2)); /* 15.2.13.4.26 */</span>
<span class="lineNum">    1354 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;value?&quot;,          mrb_hash_has_value,   MRB_ARGS_REQ(1)); /* 15.2.13.4.27 */</span>
<span class="lineNum">    1355 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;values&quot;,          mrb_hash_values,      MRB_ARGS_NONE()); /* 15.2.13.4.28 */</span>
<span class="lineNum">    1356 </span>            : 
<span class="lineNum">    1357 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;to_hash&quot;,         mrb_hash_to_hash,     MRB_ARGS_NONE()); /* 15.2.13.4.29 (x)*/</span>
<span class="lineNum">    1358 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;inspect&quot;,         mrb_hash_inspect,     MRB_ARGS_NONE()); /* 15.2.13.4.30 (x)*/</span>
<span class="lineNum">    1359 </span><span class="lineCov">         53 :   mrb_define_alias(mrb,  h, &quot;to_s&quot;,            &quot;inspect&quot;);                             /* 15.2.13.4.31 (x)*/</span>
<span class="lineNum">    1360 </span><span class="lineCov">         53 :   mrb_define_method(mrb, h, &quot;eql?&quot;,            mrb_hash_eql,         MRB_ARGS_REQ(1)); /* 15.2.13.4.32 (x)*/</span>
<span class="lineNum">    1361 </span><span class="lineCov">         53 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
